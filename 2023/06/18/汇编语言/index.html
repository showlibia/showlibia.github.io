<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no"><title>汇编语言 | Matrix's blog</title><meta name="keywords" content="汇编语言"><meta name="author" content="Matrix"><meta name="copyright" content="Matrix"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#f7f9fe"><meta name="mobile-web-app-capable" content="yes"><meta name="apple-touch-fullscreen" content="yes"><meta name="apple-mobile-web-app-title" content="汇编语言"><meta name="application-name" content="汇编语言"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="#f7f9fe"><meta property="og:type" content="article"><meta property="og:title" content="汇编语言"><meta property="og:url" content="http://blog.zymatrix.top/2023/06/18/%E6%B1%87%E7%BC%96%E8%AF%AD%E8%A8%80/index.html"><meta property="og:site_name" content="Matrix's blog"><meta property="og:description" content="一、mul,div,and,or ,shl,shr,inc,dec指令，中断int 1234mul:8位乘法结果默认放在AX中，16位乘法，结果高位默认放在DX，低位在AXdiv:除数为8位，则AL存商，AH存余数；除数为16位，AX存商，DX存余数xchg op1,op2 ;交换op1和op2的值"><meta property="og:locale" content="zh-CN"><meta property="og:image" content=""><meta property="article:author" content="Matrix"><meta property="article:tag"><meta name="twitter:card" content="summary"><meta name="twitter:image" content=""><meta name="description" content="一、mul,div,and,or ,shl,shr,inc,dec指令，中断int 1234mul:8位乘法结果默认放在AX中，16位乘法，结果高位默认放在DX，低位在AXdiv:除数为8位，则AL存商，AH存余数；除数为16位，AX存商，DX存余数xchg op1,op2 ;交换op1和op2的值"><link rel="shortcut icon" href="/favicon.ico"><link rel="canonical" href="http://blog.zymatrix.top/2023/06/18/%E6%B1%87%E7%BC%96%E8%AF%AD%E8%A8%80/"><link rel="preconnect" href="//cdn.cbd.int"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><meta name="google-site-verification" content="xxx"/><meta name="baidu-site-verification" content="code-xxx"/><meta name="msvalidate.01" content="xxx"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.cbd.int/node-snackbar@0.1.16/dist/snackbar.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.cbd.int/@fancyapps/ui@5.0.28/dist/fancybox/fancybox.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  linkPageTop: undefined,
  peoplecanvas: {"enable":true,"img":"https://upload-bbs.miyoushe.com/upload/2023/09/03/125766904/ee23df8517f3c3e3efc4145658269c06_5714860933110284659.png"},
  postHeadAiDescription: {"enable":true,"gptName":"AnZhiYu","mode":"local","switchBtn":false,"btnLink":"https://afdian.net/item/886a79d4db6711eda42a52540025c377","randomNum":3,"basicWordCount":1000,"key":"xxxx","Referer":"https://xx.xx/"},
  diytitle: {"enable":true,"leaveTitle":"w(ﾟДﾟ)w 不要走！再看看嘛！","backTitle":"♪(^∇^*)欢迎肥来！"},
  LA51: undefined,
  greetingBox: undefined,
  twikooEnvId: '',
  commentBarrageConfig:undefined,
  root: '/',
  preloader: {"source":3},
  friends_vue_info: undefined,
  navMusic: true,
  mainTone: undefined,
  authorStatus: undefined,
  algolia: undefined,
  localSearch: undefined,
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"简","rightMenuMsgToTraditionalChinese":"转为繁体","rightMenuMsgToSimplifiedChinese":"转为简体"},
  noticeOutdate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":330},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    simplehomepage: true,
    post: false
  },
  runtime: '天',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"copy":true,"copyrightEbable":false,"limitCount":50,"languages":{"author":"作者: Matrix","link":"链接: ","source":"来源: Matrix's blog","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。","copySuccess":"复制成功，复制和转载请标注本文地址"}},
  lightbox: 'fancybox',
  Snackbar: {"chs_to_cht":"你已切换为繁体","cht_to_chs":"你已切换为简体","day_to_night":"你已切换为深色模式","night_to_day":"你已切换为浅色模式","bgLight":"#425AEF","bgDark":"#1f1f1f","position":"top-center"},
  source: {
    justifiedGallery: {
      js: 'https://cdn.cbd.int/flickr-justified-gallery@2.1.2/dist/fjGallery.min.js',
      css: 'https://cdn.cbd.int/flickr-justified-gallery@2.1.2/dist/fjGallery.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: true,
  isAnchor: false,
  shortcutKey: undefined,
  autoDarkmode: true
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  configTitle: 'Matrix's blog',
  title: '汇编语言',
  postAI: '',
  pageFillDescription: '一、muldivandor shlshrincdec指令中断int, 总线, 二、寄存器, 1.ds寄存器段地址、偏移地址、物理地址, 2.CS-IP代码段寄存器jmpjcxz指令, 3.SS-SP寄存器栈的pushpop指令, 4.bpsidi寄存器寻址方式以及其他的寄存器, 5.标志位寄存器ZFPFSFCFOFDF和串传送指令pushf和popf, 6.条件判断语句cmpjejajbadcsbb, 三、编写程序, 1.循环语句loopcall和ret指令写函数call far ptr和retf指令本质是栈, 2.代码段、数据段、栈段、dup指令, 3.offset指令jmp short、fardword ptr等跳转指令, 四、中断, 1.操作显存数据, 2.标号, 3.直接定址表, 4.中断及其处理, 5.0号中断改编, 6.单步中断, 7.int指令引发的中断, 8.BIOS和DOS中断处理, 9.端口读写, CMOS RAM 芯片, 10.外中断, 11.PC机键盘处理, 12.int 9中断例程定制, 13.中断响应外设一指令中断位乘法结果默认放在中位乘法结果高位默认放在低位在除数为位则存商存余数除数为位存商存余数交换和的值将变量名或标号的偏移地址送给在二进制下一位位对比两位皆为则结果也为其他的皆为二进制下有一个就为其他的都是和运算常常用于码大小写转换转化为大写字母转换为小写字母都是对无符号数的逻辑移位算术移位是对有符号数的移位算数移位时要把最前面的符号数不变表示左移一位相当于乘以表示右移一位相当于除以占位符占据一个字节引发内中断相当于跳转调用号中断处理程序总线地址总线宽度为根寻址能力就为数据总线数据总线宽度为根一次传输位二寄存器寄存器段地址偏移地址物理地址物理地址段地址左移一位偏移地址通常用来存储段地址段前缀用于显式地指出内存单元的段地址的一般来说默认为注意赋值给不能直接用数字赋值而应该先赋值给再赋值给代码段寄存器指令代码段寄存器表示的是段地址指令指针寄存器表示的是偏移地址在时可以用命令来修改的值来修改内存中的值在计算机中代码和数据是一样的表示跳转到地址为的地方即修改了表示讲的值修改为的值不变指令为有条件转移指令所有的有条件转移指令都是短转移其功能相当于标号寄存器栈的指令和栈的基本操作始终指向的是栈顶元素和指令能够修改的值使使表示的是栈的地址寄存器寻址方式以及其他的寄存器寻址方式注意方括号内只能用和数字和不能同时出现直接寻址寄存器间接寻址寄存器相对寻址用于结构体用于数组用于二维数组基址变址寻址用于二维数组相对基址变址寻址用于结构中的数组项用于二维数组只要在中使用而指令中没有显性地给出段地址段地址就默认在中标志位寄存器和串传送指令和零标志位记录相关指令执行后判断结果是否为如果为则不为则奇偶标志位记录相关指令执行后结果的所有位中的个数是否为偶数如果是偶数则奇数则为符号标志位记录相关指令执行后结果是否为负如果为负则否则为进位标志位进行无符号数运算时记录运算结果的最高有效位的进位值或从更高位的借位值溢出标志位对有符号数运算的溢出标志如果发生溢出则没溢出则方向标志位在串处理指令中控制每次操作后的增减每次操作后递增每次操作后递减串传送指令相当于中没有这样的指令仅作描述将指向的内存单元中的字节送入中然后根据的值将和递增或递减类似的的功能是将指向的内存单元中的字节送入中然后根据的值将和递增或递减这两个指令常和配合使用这两者等价也就是说会根据的值重复执行后面的指令的功能是将标志寄存器的值压栈则是从栈中弹出数据送入标志寄存器用以直接访问标志寄存器条件判断语句带进位加法指令表示带借位减法指令表示比较指令相当于减法指令只是不保存结果而是对标志位寄存器产生影响其实我们通过指令执行后相关标志位的值就可以看出比较的结果如果则所以如果则所以如果则将产生借位所以如果则不必借位所以如果则既不必借位结果也不为所以并且如果则既可能借位结果可能为所以或现在我们可以看出比较指令的设计思路即通过做减法运算影响标志寄存器标志寄存器的相关记录位记录了比较的结果反过来指令的逻辑含义是比较和中的值如果执行后说明说明说明说明且说明或说明以为例总结一下执行指令后和的值是如何来说明比较的结果的如果而说明没有溢出逻辑上真正结果的正负实际结果的正负因实际结果为负所以逻辑上真正的结果为负所以如果而说明有溢出逻辑上真正的结果的正负实际结果的正负因实际结果为负实际结果为负而又有溢出这说明是由于溢出导致了实际结果为负简单分析就可以看出如果因为溢出导致了实际结果为负那么逻辑上真正的结果必然为正这样说明了如果而说明溢出逻辑上真正结果的正负实际结果的正负因实际结果为非负而说明溢出则结果为非所以实际结果为正实际结果为正而又有溢出这说明是由于溢出导致了实际结果非负简单分析一下就可以看出如果因为溢出导致了实际结果为正那么逻辑上真正的结果必然为负这样说明了如果而说明没有溢出逻辑上真正的结果的正负实际结果的正负因实际结果非负所以逻辑上真正的结果非负所以利用指令进行比较改变标志寄存器的值再用条件转移指令进行转移三编写程序循环语句和指令写函数和指令本质是栈的循环次数由的值来确定调用的函数要一般写在后面防止第二次调用指令会进行两步操作将当前的或和入栈转移标号指令入栈的为后面的指令的地址标号类似地入栈的和都是后面的指令的地址返回的是的下一行指令且指令使用的是栈中的内容修改的内容从而实现近转移即段内返回相当于而修改的是和的内容实现远转移相当于同时使用这两个指令会改变的值还有的用法即先把原入栈再改变为代码段数据段栈段指令字节型位字型位双字型位这些相当于语言里面的定义数据类型注意在十六进制里表示数字不能以字母为开头要在前面加上在数据定义之后可以用伪指令来表示程序的开始处并用来表示结束定义了个字节值都为定义了个字节即重复三次定义了个字节类似的都可以这样用指令等跳转指令的功能是取得标号的偏移地址可以用来表示指针转换把数据的类型转换段内短转移对的修改范围为单位是字节跳转实际上是计算偏移地址差然后加上这个差向上跳转差是负数段内近转移对的修改范围为段间转移也称远转移修改的是和的值内存单元地址段内转移功能从内存单元地址处开始存放着一个字是转移的目的偏移地址内存单元地址可用寻址方式的任一格式给出修改的是的值内存单元地址段间转移功能从内存单元地址处开始存放着两个字高地址处的字是转移的目的段地址低地址处是转移的目的偏移地址内存单元地址可用寻址方式的任一格式给出修改的是和的值例如这里使用是表示传入的是一个字的类型执行后也就是高地址的的值赋给了低地址的赋给了四中断操作显存数据主存储器地址空间大小为地址从到其他各类地址空间地址从到显存地址空间大小为地址是从到其中共的空间是行列的彩色字符模式第页的显示缓冲区每个位置需要两个字节一个字每一行就有个字节对每个位置的两个字节低位字节存储的是要显示符号的高位字节存储的是显示属性的字节如图是高字节的属性屏幕中间显示三行彩色字字符属性代码十进制将字符输出到屏幕中央显示器可以显示行每行个字符每个字符两个字节高位放属性低位放码放入缓冲区下一个字符移动到下一行字符串从头开始循环次输出三行标号标号既可以用于代码段也可以用于数据段同时用标号来取偏移地址或者用以下表示方法成为数据标号数据标号标记了存储数据的单元的地址和长度它不同于仅仅表示地址的地址标号直接定址表数据的直接定址表建立一张表表格依次存储字符我们可以通过数值直接查找到对应的字符用传送要显示的数据字符表右移位中得到高位的值中为低位的值用高位的值作为相对于的偏移取得对应的字符用低位的值作为相对于的偏移取得对应的字符子程序中在数值中和字符之间建立的映射关系位以数值为表中的偏移可以找到对应的字符代码的直接定址表可以在直接定址表中存储子程序的地址方便地实现不同子程序的调用中断及其处理中断向量表每个入口地址占用四个字节保存和总共个字节号中断由除法除以触发执行后相当于中断向量表起始地址为中断程序在其他位置可由中断向量表寻址跳转类代码描述号中断改编中断向量表在内存中存放对于机中断向量表指定放在内存地址处从内存到的个单元中存放着中断向量表支持个中断但是实际上系统中要处理的中断事件远没有达到个所以在中断向量表中有许多单元是空的中断向量表是系统中最重要的内存区只用来存放中断处理程序的入口地址系统和其他应用程序都不会随便使用这段空间我们可以利用中断向量表中的空闲单元来存放我们的程序一般情况下从至的个字节的空间所对应的中断向量表项都是空的操作系统和其他应用程序都不占用我们估计的长度不可能超过个字节结论我们可以将传送到内存处由于中断例程不可能到达个那么多所以中断向量表中还有很多是空的比如这个字节所以便把中断例程放置在这个位置安装中断例程目的地址即源地址即的偏移地址也就是中断处理程序中断处理程序的字节数也就是要转移的数量传输方向为正把中断处理程序安装至将中断例程的入口地址放置到中断向量表中将中断处理程序的入口放在号中断向量中中断处理程序为了防止字符串被覆盖所以将其放在中断例程里显存段地址第行中间位置字符串的偏移地址字符串数目返回单步中断基本上在执行一条指令后如果检测到标志寄存器的位为则产生单步中断引发中断过程单步中断的中断类型码为则它所引发的中断过程如下取得中断类型码此时标志寄存器入栈设置为入栈响应中断的特殊情况一般情况下在执行完当前指令后如果检测到中断信息就响应中断引发中断过程可是在有些情况下在执行完当前指令后即便是发生中断也不会响应对于这些情况这里就不一一举例只是用一种情况进行说明在执行完向寄存器传送数据的指令后即便是发生中断也不会响应这样做的主要原因是联合指向栈顶而对它们的设置应该连续完成如果在执行完设置的指令后响应中断引发中断过程要在栈中压入标志寄存器的值而改变并未改变指向的不是正确的栈顶将引起错误所以在执行完设置的指令后不响应中断这给连续设置和指向正确的栈顶提供了一个时机即我们应该利用这一特性将设置和的指令连续存放使得的指令紧接着设置的指令执行而在此之间不会引发中断过程比如我们要将栈顶设置应该而不应该指令引发的中断格式为中断类型码引发的过程是取得中断类型码此时标志寄存器入栈设置为入栈中断的中断例程功能为显示一个用结束的字符串中断例程安装在处参数行号列号颜色指向字符串首地址安装中断向量表源地址偏移如果表示已经处理完毕执行指令进入中断例程之前标志寄存器当前的和被压入栈中在执行完中断例程后应该用指令恢复执行前的标志寄存器和的值从而接着执行应用程序指令和指令的配合使用与指令和指令的配合使用具有相似的思路和中断处理固化在中包括设备的处理程序和许多常用的例行程序对用户程序来说可由特定指令为中断号通过软终端的方式调用不管是否装入系统这些调用可以直接控制设备系统功能调用是为程序员编写汇编语言源程序提供了一组常用子程序多个可在汇编语言程序中直接调用这些子程序的主要功能包括设备管理如键盘显示器打印机磁盘等的管理文件管理和目录操作其他管理如内存时间日期等管理这些子程序给用户编程带来很大方便用户不必了解有关的设备电路接口等方面的问题只需直接调用即可规定用进入各功能调用子程序的入口并为每个功能调用规定了一个功能号以便进入各个相应子程序的入口功能调用的子程序已按顺序编号功能号其调用方法是功能号根据要使用的功能调用设置入口参数入口参数指定寄存器将功能调用的编号送入寄存器发送软中断指令调用结束后系统将出口参数送到指定寄存器内存或直接送到输出设备端口读写可以直接读写个地方的数据内部的寄存器内存单元端口通过端口地址来定位端口因为端口所在的芯片和通过总线相连所以端口地址和内存地址一样通过地址总线来传送系统中最多可以定位个不同的端口则端口地址的范围为端口的读写指令只有两条和分别从端口读取和写入数据比较执行内存访问指令和端口访问指令时总线上的信息当端口号大于时必须将端口号存入再使用访问内存通过地址线将地址信息发出通过控制线发出内存读命令选中存储器芯片并通知它将要从中读取数据存储器将号单元中的数据通过数据线送入访问端口将端口号为的端口读出字节至通过地址线将地址信息发出通过控制线发出端口读命令选中端口所在的芯片并通知它将要从中读取数据端口所在的芯片将端口中的数据通过数据线送入和指令中只能使用或来存放从端口中读入的数据或要发送到端口中的数据位端口用位端口用芯片该芯片有两个端口端口地址为和通过这两个端口来读写为地址端口存放要访问的单元的地址为数据端口存放从选定的单元中读取的数据或要写入其中的数据在中存放着当前的时间年月日时分秒这个信息的长度都位个字节存放单元为时间秒分时日月年地址字节这些数据以码的方式存放十进制数码码中存储着当前的时间年月日时分秒这个信息的长度都为个字节存放单元为秒分时日月年这些数据以码存储码是以位二进制数表示十进制数的编码方法例如十进制的对应的码为十进制对应的码为因此一个字节可以表示两个码的两位十进制值读取的信息需要向地址写入要访问的单元地址用寄存器然后从数据端口中取得指定单元的数据码值进制数对应的码显示缓存地址为处显示器为字符宽行每个字符用个字节显示高位字节为字符低位字节为显示属性可采用默认属性显示年份从号单元读取年份外中断可屏蔽中断可屏蔽中断是可以不响应的外中断是否响应可屏蔽中断要看标志寄存器的位的设置当检测到可屏蔽中断信息时如果则在执行完当前指令后响应中断引发中断过程如果则不响应可屏蔽中断因为可屏蔽中断信息来自于外部中断类型码是通过数据总线送入的而内中断的中断类型码是在内部产生的现在我们可以解释中断过程中将置为的原因了将置的原因就是在进入中断处理程序后禁止其他的可屏蔽中断如果在中断处理程序中需要处理可屏蔽中断可以用指令将置提供的设置的指令如下设置设置不可屏蔽中断不可屏蔽中断是必须响应的外中断当检测到不可屏蔽中断信息时则在执行完当前指令后立即响应引发中断过程对于不可屏蔽中断的中断类型码固定为所以中断过程中不需要取中断类型码则不可屏蔽中断的中断过程为标志寄存器入栈入栈几乎所有由外设引发的外中断都是可屏蔽中断当外设有需要处理的事件比如说键盘输入发生时相关芯片向发出可屏蔽中断信息机键盘处理键盘输入键盘上的每一个键相当于一个开关键盘中有一个芯片对键盘上的每一个键的开关状态进行扫描按下一个键时开关接通该芯片就产生一个扫描码扫描码说明了按下的键在键盘上的位置扫描码被送入主板上的相关接口芯片的寄存器中该寄存器的端口地址为松开按下的键时也产生一个扫描码扫描码说明了松开的键在键盘上的位置松开按键时产生的扫描码也被送入端口中一般将按下一个键时产生的扫描码称为通码松开一个键产生的扫描码称为断码扫描码长度为一个字节通码的第位为断码的第位为即断码通码引发号中断键盘的输入到达端口时相关的芯片就会向发出中断类型码为的可屏蔽中断信息检测到该中断信息后如果则响应中断引发中断过程转去执行中断例程执行中断例程提供了中断例程用来进行基本的键盘输入处理主要的工作如下读出端口中的扫描码如果是字符键的扫描码将该扫描码和它所对应的字符码即码送入内存中的键盘缓冲区如果是控制键比如和切换键比如的扫描码则将其转变为状态字节用二进制位记录控制键和切换键状态的字节写入内存中存储状态字节的单元对键盘系统进行相关的控制比如说向相关芯片发出应答信息键盘缓冲区是系统启动后用于存放中断例程所接收的键盘输入的内存区该内存区可以存储个键盘输入因为中断例程除了接收扫描码外还要产生和扫描码对应的字符码所以在键盘缓冲区中一个键盘输入用一个字单元存放高位字节存放扫描码低位字节存放字符码中断例程定制仿照前面的中断响应外设键盘输入将引发号中断提供了中断例程在号中断发生后执行中断例程从端口读出扫描码并将其转化为相应的码或状态信息存储在内存的指定空间键盘缓冲区或状态字节中一般的键盘输入在执行完中断例程后都放到了键盘缓冲区中提供了中断例程供程序员调用中断例程中包含的一个最重要的功能是从键盘缓冲区中读取一个键盘输入该功能的编号为应用中断例程对磁盘进行读写英寸软盘分为上下两面每面有个磁道每个磁道又分为个扇区每个扇区的大小为个字节则面磁道扇区字节磁盘的实际访问由磁盘控制器进行我们可以通过控制磁盘控制器来访问磁盘只能以扇区为单位对磁盘进行读写在读写扇区的时候要给出面号磁道号和扇区号面号和磁道号从开始而扇区号从开始提供的访问磁盘的中断例程为读取面道扇区的内容到的程序如下所示入口参数的功能号表示读扇区读取的扇区数磁道号扇区号磁头号对于软盘即面号因为一个面用一个磁头来读写驱动器号软驱从开始软驱软驱硬盘从开始硬盘硬盘指向接收从扇区读入数据的内存区返回参数操作成功读入的扇区数操作失败出错代码将中的内容写入面道扇区入口参数的功能号表示写扇区写入的扇区数磁道号扇区号磁头号面驱动器号软驱从开始软驱软驱硬盘从开始硬盘硬盘指向将写入磁盘的数据返回参数操作成功写入的扇区数操作失败出错代码',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2024-09-07 14:24:51',
  postMainColor: '',
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
      win.saveToLocal = {
        set: (key, value, ttl) => {
          if (ttl === 0) return
          const now = Date.now()
          const expiry = now + ttl * 86400000
          const item = {
            value,
            expiry
          }
          localStorage.setItem(key, JSON.stringify(item))
        },
      
        get: key => {
          const itemStr = localStorage.getItem(key)
      
          if (!itemStr) {
            return undefined
          }
          const item = JSON.parse(itemStr)
          const now = Date.now()
      
          if (now > item.expiry) {
            localStorage.removeItem(key)
            return undefined
          }
          return item.value
        }
      }
    
      win.getScript = (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        script.onerror = reject
        script.onload = script.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          script.onload = script.onreadystatechange = null
          resolve()
        }

        Object.keys(attr).forEach(key => {
          script.setAttribute(key, attr[key])
        })

        document.head.appendChild(script)
      })
    
      win.getCSS = (url, id = false) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onerror = reject
        link.onload = link.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          link.onload = link.onreadystatechange = null
          resolve()
        }
        document.head.appendChild(link)
      })
    
      win.activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#18171d')
        }
      }
      win.activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#f7f9fe')
        }
      }
      const t = saveToLocal.get('theme')
    
          const isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches
          const isLightMode = window.matchMedia('(prefers-color-scheme: light)').matches
          const isNotSpecified = window.matchMedia('(prefers-color-scheme: no-preference)').matches
          const hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

          if (t === undefined) {
            if (isLightMode) activateLightMode()
            else if (isDarkMode) activateDarkMode()
            else if (isNotSpecified || hasNoSupport) {
              const now = new Date()
              const hour = now.getHours()
              const isNight = hour <= 6 || hour >= 18
              isNight ? activateDarkMode() : activateLightMode()
            }
            window.matchMedia('(prefers-color-scheme: dark)').addListener(e => {
              if (saveToLocal.get('theme') === undefined) {
                e.matches ? activateDarkMode() : activateLightMode()
              }
            })
          } else if (t === 'light') activateLightMode()
          else activateDarkMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
      const detectApple = () => {
        if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
          document.documentElement.classList.add('apple')
        }
      }
      detectApple()
    })(window)</script><meta name="generator" content="Hexo 5.4.2"><link rel="alternate" href="/atom.xml" title="Matrix's blog" type="application/atom+xml">
</head><body data-type="anzhiyu"><div id="web_bg"></div><div id="an_music_bg"></div><div id="loading-box" onclick="document.getElementById(&quot;loading-box&quot;).classList.add(&quot;loaded&quot;)"><div class="loading-bg"><img class="loading-img nolazyload" alt="加载头像" src="https://npm.elemecdn.com/anzhiyu-blog-static@1.0.4/img/avatar.jpg"/><div class="loading-image-dot"></div></div></div><script>const preloader = {
  endLoading: () => {
    document.getElementById('loading-box').classList.add("loaded");
  },
  initLoading: () => {
    document.getElementById('loading-box').classList.remove("loaded")
  }
}
window.addEventListener('load',()=> { preloader.endLoading() })
setTimeout(function(){preloader.endLoading();},10000)

if (true) {
  document.addEventListener('pjax:send', () => { preloader.initLoading() })
  document.addEventListener('pjax:complete', () => { preloader.endLoading() })
}</script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.1.10/progress_bar/progress_bar.css"/><script async="async" src="https://cdn.cbd.int/pace-js@1.2.4/pace.min.js" data-pace-options="{ &quot;restartOnRequestAfter&quot;:false,&quot;eventLag&quot;:false}"></script><div class="post" id="body-wrap"><header class="post-bg" id="page-header"><nav id="nav"><div id="nav-group"><span id="blog_name"><a id="site-name" href="/" accesskey="h"><div class="title">Matrix's blog</div><i class="anzhiyufont anzhiyu-icon-house-chimney"></i></a></span><div class="mask-name-container"><div id="name-container"><a id="page-name" href="javascript:anzhiyu.scrollToDest(0, 500)">PAGE_NAME</a></div></div><div id="menus"></div><div id="nav-right"><div class="nav-button" id="randomPost_button"><a class="site-page" onclick="toRandomPost()" title="随机前往一个文章" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-dice"></i></a></div><input id="center-console" type="checkbox"/><label class="widget" for="center-console" title="中控台" onclick="anzhiyu.switchConsole();"><i class="left"></i><i class="widget center"></i><i class="widget right"></i></label><div id="console"><div class="console-card-group-reward"><ul class="reward-all console-card"><li class="reward-item"><a href="/null" target="_blank"><img class="post-qr-code-img" alt="微信" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/null"/></a><div class="post-qr-code-desc">微信</div></li><li class="reward-item"><a href="/null" target="_blank"><img class="post-qr-code-img" alt="支付宝" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/null"/></a><div class="post-qr-code-desc">支付宝</div></li></ul></div><div class="console-card-group"><div class="console-card-group-left"><div class="console-card" id="card-newest-comments"><div class="card-content"><div class="author-content-item-tips">互动</div><span class="author-content-item-title"> 最新评论</span></div><div class="aside-list"><span>正在加载中...</span></div></div></div><div class="console-card-group-right"><div class="console-card tags"><div class="card-content"><div class="author-content-item-tips">兴趣点</div><span class="author-content-item-title">寻找你感兴趣的领域</span><div class="card-tags"><div class="item-headline"></div><div class="card-tag-cloud"><a href="/tags/CTF/" style="font-size: 1.05rem;">CTF<sup>1</sup></a><a href="/tags/Java/" style="font-size: 1.05rem;">Java<sup>2</sup></a><a href="/tags/JavaSE/" style="font-size: 1.05rem;">JavaSE<sup>1</sup></a><a href="/tags/Linux-Kernel/" style="font-size: 1.05rem;">Linux Kernel<sup>1</sup></a><a href="/tags/OS/" style="font-size: 1.05rem;">OS<sup>2</sup></a><a href="/tags/Python/" style="font-size: 1.05rem;">Python<sup>1</sup></a><a href="/tags/Web%E5%90%8E%E7%AB%AF/" style="font-size: 1.05rem;">Web后端<sup>1</sup></a><a href="/tags/csapp/" style="font-size: 1.05rem;">csapp<sup>1</sup></a><a href="/tags/%E5%93%B2%E5%AD%A6/" style="font-size: 1.05rem;">哲学<sup>5</sup></a><a href="/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/" style="font-size: 1.05rem;">数据库<sup>1</sup></a><a href="/tags/%E6%9D%82%E8%AE%B0/" style="font-size: 1.05rem;">杂记<sup>3</sup></a><a href="/tags/%E6%B1%87%E7%BC%96%E8%AF%AD%E8%A8%80/" style="font-size: 1.05rem;">汇编语言<sup>1</sup></a><a href="/tags/%E9%A9%AC%E5%88%97%E6%AF%9B/" style="font-size: 1.05rem;">马列毛<sup>5</sup></a></div></div><hr/></div></div><div class="console-card history"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-box-archiv"></i><span>文章</span></div><div class="card-archives"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-archive"></i><span>归档</span><a class="card-more-btn" href="/archives/" title="查看更多">
    <i class="anzhiyufont anzhiyu-icon-angle-right"></i></a></div><ul class="card-archive-list"><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/09/"><span class="card-archive-list-date">九月 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">3</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/08/"><span class="card-archive-list-date">八月 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">1</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/04/"><span class="card-archive-list-date">四月 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">2</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/03/"><span class="card-archive-list-date">三月 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">1</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/01/"><span class="card-archive-list-date">一月 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">1</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2023/08/"><span class="card-archive-list-date">八月 2023</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">1</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2023/06/"><span class="card-archive-list-date">六月 2023</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">1</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2023/05/"><span class="card-archive-list-date">五月 2023</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">1</span><span>篇</span></div></a></li></ul></div><hr/></div></div></div><div class="button-group"><div class="console-btn-item"><a class="darkmode_switchbutton" title="显示模式切换" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-moon"></i></a></div><div class="console-btn-item" id="consoleHideAside" onclick="anzhiyu.hideAsideBtn()" title="边栏显示控制"><a class="asideSwitch"><i class="anzhiyufont anzhiyu-icon-arrows-left-right"></i></a></div><div class="console-btn-item" id="consoleMusic" onclick="anzhiyu.musicToggle()" title="音乐开关"><a class="music-switch"><i class="anzhiyufont anzhiyu-icon-music"></i></a></div></div><div class="console-mask" onclick="anzhiyu.hideConsole()" href="javascript:void(0);"></div></div><div class="nav-button" id="nav-totop"><a class="totopbtn" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i><span id="percent" onclick="anzhiyu.scrollToDest(0,500)">0</span></a></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);" title="切换"><i class="anzhiyufont anzhiyu-icon-bars"></i></a></div></div></div></nav><div id="post-info"><div id="post-firstinfo"><div class="meta-firstline"><a class="post-meta-original">原创</a><span class="post-meta-categories"><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-inbox post-meta-icon"></i><a class="post-meta-categories" href="/categories/cs/" itemprop="url">cs</a></span><span class="article-meta tags"><a class="article-meta__tags" href="/tags/%E6%B1%87%E7%BC%96%E8%AF%AD%E8%A8%80/" tabindex="-1" itemprop="url"> <span> <i class="anzhiyufont anzhiyu-icon-hashtag"></i>汇编语言</span></a></span></div></div><h1 class="post-title" itemprop="name headline">汇编语言</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="anzhiyufont anzhiyu-icon-calendar-days post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" itemprop="dateCreated datePublished" datetime="2023-06-17T16:00:00.000Z" title="发表于 2023-06-18 00:00:00">2023-06-18</time><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-history post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" itemprop="dateCreated datePublished" datetime="2024-09-07T06:24:51.439Z" title="更新于 2024-09-07 14:24:51">2024-09-07</time></span></div><div class="meta-secondline"><span class="post-meta-separator"></span><span class="post-meta-pv-cv" id="" data-flag-title="汇编语言"><i class="anzhiyufont anzhiyu-icon-fw-eye post-meta-icon"></i><span class="post-meta-label" title="阅读量">阅读量:</span><span id="busuanzi_value_page_pv"><i class="anzhiyufont anzhiyu-icon-spinner anzhiyu-spin"></i></span></span><span class="post-meta-separator">       </span><span class="post-meta-position" title="作者IP属地为武汉"><i class="anzhiyufont anzhiyu-icon-location-dot"></i>武汉</span></div></div></div><section class="main-hero-waves-area waves-area"><svg class="waves-svg" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M -160 44 c 30 0 58 -18 88 -18 s 58 18 88 18 s 58 -18 88 -18 s 58 18 88 18 v 44 h -352 Z"></path></defs><g class="parallax"><use href="#gentle-wave" x="48" y="0"></use><use href="#gentle-wave" x="48" y="3"></use><use href="#gentle-wave" x="48" y="5"></use><use href="#gentle-wave" x="48" y="7"></use></g></svg></section><div id="post-top-cover"><img class="nolazyload" id="post-top-bg" src=""></div></header><main id="blog-container"><div class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container" itemscope itemtype="http://blog.zymatrix.top/2023/06/18/%E6%B1%87%E7%BC%96%E8%AF%AD%E8%A8%80/"><header><a class="post-meta-categories" href="/categories/cs/" itemprop="url">cs</a><a href="/tags/%E6%B1%87%E7%BC%96%E8%AF%AD%E8%A8%80/" tabindex="-1" itemprop="url">汇编语言</a><h1 id="CrawlerTitle" itemprop="name headline">汇编语言</h1><span itemprop="author" itemscope itemtype="http://schema.org/Person">Matrix</span><time itemprop="dateCreated datePublished" datetime="2023-06-17T16:00:00.000Z" title="发表于 2023-06-18 00:00:00">2023-06-18</time><time itemprop="dateCreated datePublished" datetime="2024-09-07T06:24:51.439Z" title="更新于 2024-09-07 14:24:51">2024-09-07</time></header><h3 id="一、mul-div-and-or-shl-shr-inc-dec指令，中断int"><a href="#一、mul-div-and-or-shl-shr-inc-dec指令，中断int" class="headerlink" title="一、mul,div,and,or ,shl,shr,inc,dec指令，中断int"></a>一、mul,div,and,or ,shl,shr,inc,dec指令，中断int</h3> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mul:8位乘法结果默认放在AX中，16位乘法，结果高位默认放在DX，低位在AX</span><br><span class="line">div:除数为8位，则AL存商，AH存余数；除数为16位，AX存商，DX存余数</span><br><span class="line">xchg op1,op2 ;交换op1和op2的值</span><br><span class="line">lea reg,mem(Label) 将变量名或标号的偏移地址送给reg</span><br></pre></td></tr></table></figure>

 <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">and:在二进制下一位位对比，两位皆为1则结果也为1，其他的皆为0</span><br><span class="line">or:二进制下，有一个1就为1，其他的都是0</span><br><span class="line">and和or运算常常用于ASCII码大小写转换</span><br><span class="line">and al,11011111B    转化为大写字母</span><br><span class="line">or  al,00100000B    转换为小写字母</span><br></pre></td></tr></table></figure>

 <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">都是对无符号数的逻辑移位。算术移位是对有符号数的移位，算数移位时要把最前面的符号数不变</span><br><span class="line">shl al,1     表示左移一位，相当于乘以2</span><br><span class="line">shr al,1     表示右移一位，相当于除以2</span><br><span class="line">nop:占位符，占据一个字节</span><br></pre></td></tr></table></figure>

 <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">int 0    引发内中断，相当于跳转调用0号中断处理程序</span><br></pre></td></tr></table></figure>

  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">inc si   si++</span><br><span class="line">dec si   si--</span><br></pre></td></tr></table></figure>

<h4 id="总线"><a href="#总线" class="headerlink" title="总线"></a>总线</h4><p>地址总线：宽度为N根，寻址能力就为2^N bit</p>
<p>数据总线：8086数据总线宽度为16根，一次传输1byte(2 bit)（16位）</p>
<h3 id="二、寄存器"><a href="#二、寄存器" class="headerlink" title="二、寄存器"></a>二、寄存器</h3><h4 id="1-ds寄存器，段地址、偏移地址、物理地址"><a href="#1-ds寄存器，段地址、偏移地址、物理地址" class="headerlink" title="1.ds寄存器，段地址、偏移地址、物理地址"></a>1.ds寄存器，段地址、偏移地址、物理地址</h4><ul>
<li>物理地址 &#x3D; 段地址左移一位 + 偏移地址</li>
<li>DS（Data Segment) 通常用来存储段地址</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://raw.githubusercontent.com/showlibia/img/main/image-20230616122855288.png"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://raw.githubusercontent.com/showlibia/img/main/image-20230616122922296.png"></p>
<ul>
<li>段前缀：用于显式地指出内存单元的段地址的”ds:””cs:””ss:””es:”，一般来说默认为ds</li>
<li>注意，赋值给DS不能直接用数字赋值，而应该先赋值给AX，再赋值给DS</li>
</ul>
<h4 id="2-CS-IP代码段寄存器，jmp-jcxz指令"><a href="#2-CS-IP代码段寄存器，jmp-jcxz指令" class="headerlink" title="2.CS-IP代码段寄存器，jmp,jcxz指令"></a>2.CS-IP代码段寄存器，jmp,jcxz指令</h4><ul>
<li><p>CS（code segment代码段寄存器）表示的是段地址，IP（指令指针寄存器，Instruction Pointer）表示的是偏移地址，在debug时可以用r命令来修改CS：IP的值，来修改内存中的值。在计算机中，代码和数据是一样的。</p>
</li>
<li><p>jmp 1000:3 表示跳转到地址为1000:3的地方，即修改了CS:IP，jmp  bx表示讲IP的值修改为bx，CS的值不变。</p>
</li>
<li><p>jcxz指令为有条件转移指令，所有的有条件转移指令都是短转移，其功能相当于</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">if(cx == 0) jmp short 标号</span><br></pre></td></tr></table></figure></li>
</ul>
<h4 id="3-SS-SP寄存器，栈的push-pop指令"><a href="#3-SS-SP寄存器，栈的push-pop指令" class="headerlink" title="3.SS-SP寄存器，栈的push,pop指令"></a>3.SS-SP寄存器，栈的push,pop指令</h4><ul>
<li>push和pop 栈的基本操作，SS(stack segment),SP(stack point)</li>
<li>SS:SP始终指向的是栈顶元素，push和pop指令能够修改SP的值，push使SP-2,pop使SP+2，SS:SP表示的是栈的地址。</li>
</ul>
<h4 id="4-bp-si-di寄存器，寻址方式以及其他的寄存器"><a href="#4-bp-si-di寄存器，寻址方式以及其他的寄存器" class="headerlink" title="4.bp,si,di寄存器，寻址方式以及其他的寄存器"></a>4.bp,si,di寄存器，寻址方式以及其他的寄存器</h4><ul>
<li>寻址方式：[bx+idata]  [bx+si]  [bx+di]     [bx+si+idata]  [bx+di+idata]      注意：方括号内只能用bx,si,di和数字，si和di不能同时出现</li>
</ul>
 <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">直接寻址：[idata]      </span><br><span class="line">寄存器间接寻址：[bx]  [si]  [di]  [bp]   </span><br><span class="line">寄存器相对寻址：[bx+idata]</span><br><span class="line">	用于结构体:[bx].idata</span><br><span class="line">    用于数组：idata[si]</span><br><span class="line">    用于二维数组：[bx][idata]</span><br><span class="line">基址变址寻址：[bx+si/di] [bp+si/di]  </span><br><span class="line">	用于二维数组：[bx][si]</span><br><span class="line">相对基址变址寻址：[bx+si+idata]</span><br><span class="line">	用于结构中的数组项：[bx].idata[si]</span><br><span class="line">	用于二维数组：idata[bx][si]</span><br></pre></td></tr></table></figure>

<ul>
<li>只要在[ ]中使用bp，而指令中没有显性地给出段地址，段地址就默认在SS中</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://raw.githubusercontent.com/showlibia/img/main/image-20230609161032496.png"></p>
<h4 id="5-标志位寄存器ZF-PF-SF-CF-OF-DF和串传送指令pushf和popf"><a href="#5-标志位寄存器ZF-PF-SF-CF-OF-DF和串传送指令pushf和popf" class="headerlink" title="5.标志位寄存器ZF,PF,SF,CF,OF,DF和串传送指令pushf和popf"></a>5.标志位寄存器ZF,PF,SF,CF,OF,DF和串传送指令pushf和popf</h4><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://raw.githubusercontent.com/showlibia/img/main/image-20230609163913844-1711527919810.png"></p>
<ul>
<li><p>ZF:  零标志位，记录相关指令执行后，判断结果是否为0，如果为0，则ZF &#x3D; 1,不为0则ZF &#x3D; 0;</p>
</li>
<li><p>PF:  奇偶标志位，记录相关指令执行后，结果的所有Bit位中1的个数是否为偶数，如果是偶数则pf &#x3D; 1,奇数则为0</p>
</li>
<li><p>SF:符号标志位，记录相关指令执行后，结果是否为负，如果为负则sf &#x3D; 1,否则为0</p>
</li>
<li><p>CF：进位标志位，进行无符号数运算时 ，记录运算结果的最高有效位的进位值，或从更高位的借位值</p>
</li>
<li><p>OF：溢出标志位，对有符号数运算的溢出标志，如果发生溢出则OF &#x3D; 1,没溢出则OF &#x3D; 0</p>
</li>
<li><p>DF：方向标志位，在串处理指令中，控制每次操作后si,di的增减，</p>
<p>df &#x3D; 0 每次操作后si、di递增</p>
<p>df &#x3D;1 每次操作后si、di递减</p>
</li>
<li><p>串传送指令：</p>
<p>movsb : 相当于</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mov es:[di],byte ptr ds:[si] ;8086中没有这样的指令，仅作描述</span><br></pre></td></tr></table></figure>

<p>将ds:si指向的内存单元中的字节送入es:di中，然后根据df的值，将si和di递增或递减</p>
<p>类似的，movsw的功能是将ds:si指向的内存单元中的字节送入es:di中，然后根据df的值，将si和di递增2或递减2</p>
<p>这两个指令常和rep配合使用</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">rep movsb   </span><br><span class="line"></span><br><span class="line">s:movsb</span><br><span class="line">  loop s</span><br><span class="line">;这两者等价，也就是说rep会根据cx的值重复执行后面的指令</span><br></pre></td></tr></table></figure>
</li>
<li><p>pushf的功能是将标志寄存器的值压栈，popf则是从栈中弹出数据，送入标志寄存器，用以直接访问标志寄存器</p>
</li>
</ul>
<h4 id="6-条件判断语句cmp-je-ja-jb-adc-sbb"><a href="#6-条件判断语句cmp-je-ja-jb-adc-sbb" class="headerlink" title="6.条件判断语句cmp,je,ja,jb,adc,sbb"></a>6.条件判断语句cmp,je,ja,jb,adc,sbb</h4><ul>
<li>adc:带进位加法指令，adc  ax,bx   表示 (ax) &#x3D; (ax) + (bx) + CF</li>
<li>sbb:带借位减法指令,   sbb ax,bx    表示(ax)  &#x3D; (ax) - (bx) - CF</li>
<li>cmp：比较指令，相当于减法指令，只是不保存结果，而是对标志位寄存器产生影响</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">其实，我们通过cmp指令执行后，相关标志位的值就可以看出比较的结果.</span><br><span class="line"></span><br><span class="line">cmp ax, bx</span><br><span class="line">如果(ax) = (bx) 则(ax) - (bx) = 0, 所以：zf = 1 ;</span><br><span class="line">如果(ax) ≠ (bx) 则(ax) - (bx) ≠ 0, 所以：zf = 0 ;</span><br><span class="line">如果(ax) &lt; (bx) 则(ax) - (bx) 将产生借位, 所以：cf = 1 ;</span><br><span class="line">如果(ax) ≥ (bx) 则(ax) - (bx) 不必借位, 所以：cf = 0 ；</span><br><span class="line">如果(ax) ＞ (bx) 则(ax) - (bx) 既不必借位，结果也不为0, 所以：cf = 0并且 zf = 0 ;</span><br><span class="line">如果(ax) ≤ (bx) 则(ax) - (bx) 既可能借位，结果可能为0, 所以：cf = 1 或 zf = 1 </span><br><span class="line">现在我们可以看出比较指令的设计思路，即：通过做减法运算，影响标志寄存器，标志寄存器的相关记录位记录了比较的结果. 反过来：指令cmp ax, bx的逻辑含义是比较ax和bx中的值，如果执行后：</span><br><span class="line"></span><br><span class="line">zf = 1，说明(ax) = (bx)</span><br><span class="line">zf = 0，说明(ax) ≠ (bx)</span><br><span class="line">cf = 1，说明(ax) &lt; (bx)</span><br><span class="line">cf = 0，说明(ax) ≥ (bx)</span><br><span class="line">cf = 0 且 zf = 0，说明(ax) &gt; (bx)</span><br><span class="line">cf = 1 或 zf = 1，说明(ax) ≤ (bx)</span><br><span class="line"></span><br><span class="line">以cmp ah, bh为例，总结一下cpu执行cmp指令后，sf和of的值是如何来说明比较的结果的.</span><br><span class="line"></span><br><span class="line">1) 如果sf = 1，而of = 0</span><br><span class="line">of = 0，说明没有溢出，逻辑上真正结果的正负 = 实际结果的正负;</span><br><span class="line">因 sf = 1，实际结果为负，所以逻辑上真正的结果为负，所以 (ah) &lt; (bh) .</span><br><span class="line"></span><br><span class="line">2) 如果sf = 1，而 of = 1</span><br><span class="line">of = 1，说明有溢出，逻辑上真正的结果的正负 ≠ 实际结果的正负；</span><br><span class="line">因 sf = 1， 实际结果为负.</span><br><span class="line">实际结果为负，而又有溢出，这说明是由于溢出导致了实际结果为负. 简单分析就可以看出，如果因为溢出导致了实际结果为负，那么逻辑上真正的结果必然为正.</span><br><span class="line">这样，sf = 1，of = 1，说明了 (ah) &gt; (bh).</span><br><span class="line"></span><br><span class="line">3) 如果sf = 0，而 of = 1</span><br><span class="line">of = 1，说明溢出，逻辑上真正结果的正负 = 实际结果的正负;</span><br><span class="line">因sf = 0，实际结果为非负. 而 of = 1说明溢出，则结果为非0，所以，实际结果为正.</span><br><span class="line">实际结果为正，而又有溢出，这说明是由于溢出导致了实际结果非负，简单分析一下，就可以看出，如果因为溢出导致了实际结果为正，那么逻辑上真正的结果必然为负.</span><br><span class="line">这样，sf = 0，of = 1，说明了 (ah) &lt; (bh).</span><br><span class="line"></span><br><span class="line">4) 如果 sf = 0，而of = 0</span><br><span class="line">of = 0，说明没有溢出，逻辑上真正的结果的正负 = 实际结果的正负；</span><br><span class="line">因 sf = 0，实际结果非负，所以逻辑上真正的结果非负，所以 (ah) ≥ (bh) .</span><br></pre></td></tr></table></figure>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://raw.githubusercontent.com/showlibia/img/main/image-20230609172402400-1711527964427.png"></p>
<ul>
<li>利用cmp指令进行比较，改变标志寄存器的值，再用条件转移指令进行转移</li>
</ul>
<h3 id="三、编写程序"><a href="#三、编写程序" class="headerlink" title="三、编写程序"></a>三、编写程序</h3><h4 id="1-循环语句loop，call和ret指令写函数，call-far-ptr和retf指令，本质是栈"><a href="#1-循环语句loop，call和ret指令写函数，call-far-ptr和retf指令，本质是栈" class="headerlink" title="1.循环语句loop，call和ret指令写函数，call far ptr和retf指令，本质是栈"></a>1.循环语句loop，call和ret指令写函数，call far ptr和retf指令，本质是栈</h4><ul>
<li>loop的循环次数由CX的值来确定</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://raw.githubusercontent.com/showlibia/img/main/image-20230609184432177-1711528004848.png"></p>
<p>call 调用的函数要一般写在int后面，防止第二次调用</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">call指令会进行两步操作，</span><br><span class="line"></span><br><span class="line">1）将当前的IP或CS和IP入栈           push   ip</span><br><span class="line"></span><br><span class="line">2）转移						   jmp near ptr 标号</span><br><span class="line"></span><br><span class="line">call 指令入栈的IP为call后面的指令的地址</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">call far ptr</span><br><span class="line"></span><br><span class="line">push CS</span><br><span class="line"></span><br><span class="line">push IP</span><br><span class="line"></span><br><span class="line">jmp far ptr 标号</span><br><span class="line">类似地，入栈的CS和IP都是call后面的指令的地址</span><br></pre></td></tr></table></figure>

<ul>
<li><p>ret返回的是call的下一行指令，且ret指令使用的是栈中的内容，修改IP的内容，从而实现近转移，即段内返回，相当于pop ip</p>
<p>而retf修改的是CS和IP的内容，实现远转移,相当于pop IP      pop   CS</p>
<p>同时，使用这两个指令会改变sp的值（sp+2)</p>
</li>
<li><p>call 还有call ax的用法，即先把原IP入栈，再改变IP为ax</p>
</li>
</ul>
<h4 id="2-代码段、数据段、栈段、dup指令"><a href="#2-代码段、数据段、栈段、dup指令" class="headerlink" title="2.代码段、数据段、栈段、dup指令"></a>2.代码段、数据段、栈段、dup指令</h4><ul>
<li><p>db(define byte):字节型，8位</p>
<p>dw(define word)：字型，16位</p>
<p>dd(define double word):双字型，32位</p>
</li>
</ul>
<p>这些相当于c语言里面的定义数据类型，注意，在十六进制里，表示数字不能以字母为开头，要在前面加上0，在数据定义之后可以用start伪指令来表示程序的开始处，并用end start来表示结束</p>
<ul>
<li><p>dup :    </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">db 3 dup(0)              ;定义了3个字节，值都为0</span><br><span class="line">db 3 dup(0,1,2)          ;定义了9个字节，即重复0,1,2三次</span><br><span class="line">db 3 dup(&#x27;abc&#x27;,&#x27;ABC&#x27;)    ;定义了18个字节</span><br></pre></td></tr></table></figure>

<p>类似的，dw,dd都可以这样用</p>
</li>
</ul>
<h4 id="3-offset指令-jmp-short、far-dword-ptr等跳转指令"><a href="#3-offset指令-jmp-short、far-dword-ptr等跳转指令" class="headerlink" title="3.offset指令,jmp short、far,dword ptr等跳转指令"></a>3.offset指令,jmp short、far,dword ptr等跳转指令</h4><ul>
<li>offset的功能是取得标号的偏移地址</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">ptr可以用来表示指针转换，把数据的类型转换</span><br><span class="line"></span><br><span class="line">jmp short  s  ;段内短转移，对ip的修改范围为-128~127（单位是字节），jmp跳转实际上是计算偏移地址差，然后加上这个差（向上跳转差是负数）</span><br><span class="line">jmp near ptr s ;段内近转移，对ip的修改范围为-32768~32767</span><br><span class="line">jmp far ptr s   ;段间转移，也称远转移，修改的是CS和IP的值</span><br><span class="line">jmp word ptr 内存单元地址 ;（段内转移）</span><br><span class="line">功能：从内存单元地址处开始存放着一个字，是转移的目的偏移地址，内存单元地址可用寻址方式的任一格式给出，修改的是IP的值</span><br><span class="line">jmp dword ptr 内存单元地址 ;（段间转移）</span><br><span class="line">功能：从内存单元地址处开始存放着两个字，高地址处的字是转移的目的段地址，低地址处是转移的目的偏移地址，内存单元地址可用寻址方式的任一格式给出，修改的是CS和IP的值</span><br><span class="line">例如：</span><br><span class="line">mov ax,0123h</span><br><span class="line">mov ds:[0],ax</span><br><span class="line">mov word ptr ds:[2],0  ;这里使用word ptr是表示传入的0是一个字的类型</span><br><span class="line">jmp dword ptr ds:[0]</span><br><span class="line">执行后， (CS)=0,(IP)=0123h,也就是高地址的ds:[2]的值赋给了CS,低地址的ds:[0]赋给了IP</span><br></pre></td></tr></table></figure>

<h3 id="四、中断"><a href="#四、中断" class="headerlink" title="四、中断"></a>四、中断</h3><h4 id="1-操作显存数据"><a href="#1-操作显存数据" class="headerlink" title="1.操作显存数据"></a>1.操作显存数据</h4><p>主存储器地址空间大小为640K，地址从00000到9FFFF，其他各类ROM地址空间256KB，地址从C0000到FFFFF。</p>
<p>显存地址空间大小为128K，地址是从A0000到BFFFF，其中B8000h~BFFFFh共32k的空间，是80*25（25行80列）的彩色字符模式第0页的显示缓冲区。</p>
<p>每个位置需要两个字节（一个字），每一行就有160（A0H）个字节。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://raw.githubusercontent.com/showlibia/img/main/image-20230615223135387.png"></p>
<p>对每个位置的两个字节，低位字节存储的是要显示符号的ASCII，高位字节存储的是显示属性的字节</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://raw.githubusercontent.com/showlibia/img/main/image-20230615223314026.png"></p>
<p>（如图是高字节的属性）</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line">; 屏幕中间显示三行彩色字</span><br><span class="line">assume cs:code, ds:data, ss:stack</span><br><span class="line"> </span><br><span class="line">data segment</span><br><span class="line">    db &#x27;Welcome to masm!&#x27;</span><br><span class="line">    db 2,36,113       ;字符属性代码(十进制)                                      </span><br><span class="line">data ends</span><br><span class="line"> </span><br><span class="line">stack segment</span><br><span class="line">    db 16 dup(0)</span><br><span class="line">stack ends</span><br><span class="line"> </span><br><span class="line">code segment</span><br><span class="line">start:</span><br><span class="line">    mov ax,data</span><br><span class="line">    mov ds,ax</span><br><span class="line">    mov bx,0</span><br><span class="line">    mov di,16</span><br><span class="line">    </span><br><span class="line">    mov ax,stack</span><br><span class="line">    mov ss,ax</span><br><span class="line">    mov sp,0</span><br><span class="line">    </span><br><span class="line">    mov ax,0b800h</span><br><span class="line">    mov es,ax</span><br><span class="line">    mov si,160*12+32*2;将字符输出到屏幕中央</span><br><span class="line">                      ;(显示器可以显示25行，每行80个字符，每个字符两个字节)</span><br><span class="line">    </span><br><span class="line">    mov cx,3</span><br><span class="line">s1:</span><br><span class="line">    mov dh,ds:[di] ;高位放属性</span><br><span class="line">    push cx</span><br><span class="line">    mov cx,16</span><br><span class="line">s0:</span><br><span class="line">    mov dl,ds:[bx] ;低位放ASCⅡ码</span><br><span class="line">    mov es:[si],dx ;放入缓冲区</span><br><span class="line">    add si,2</span><br><span class="line">    inc bx         ;下一个字符</span><br><span class="line">    loop s0</span><br><span class="line">    </span><br><span class="line">    pop cx</span><br><span class="line">    inc di</span><br><span class="line">    add si,80h    ;移动到下一行</span><br><span class="line">    sub bx,bx     ;字符串从头开始</span><br><span class="line">    loop s1       ;循环3次,输出三行</span><br><span class="line">    </span><br><span class="line">    mov ax,4c00h</span><br><span class="line">    int 21h</span><br><span class="line">code ends</span><br><span class="line">end start</span><br></pre></td></tr></table></figure>

<h4 id="2-标号"><a href="#2-标号" class="headerlink" title="2.标号"></a>2.标号</h4><p>标号既可以用于代码段，也可以用于数据段，同时用offset+标号来取偏移地址</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://raw.githubusercontent.com/showlibia/img/main/image-20230615233534743.png"></p>
<p>或者用以下表示方法，成为数据标号，数据标号标记了存储数据的单元的地址和长度，它不同于仅仅表示地址的地址标号</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://raw.githubusercontent.com/showlibia/img/main/image-20230615233451000.png"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://raw.githubusercontent.com/showlibia/img/main/image-20230615234050440.png"></p>
<h4 id="3-直接定址表"><a href="#3-直接定址表" class="headerlink" title="3.直接定址表"></a>3.直接定址表</h4><ol>
<li>数据的直接定址表：建立一张表，表格依次存储字符 “0” ~ “F”，我们可以通过数值 0~15 直接查找到对应的字符。</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">;用 al 传送要显示的数据</span><br><span class="line">showbyte:   jmp short show</span><br><span class="line">            table db &#x27;0123456789ABCDEF&#x27;    ;字符表</span><br><span class="line">    show:    push bx</span><br><span class="line">            push es</span><br><span class="line"></span><br><span class="line">            mov ah,al</span><br><span class="line">            shr ah,1</span><br><span class="line">            shr ah,1            </span><br><span class="line">            shr ah,1            </span><br><span class="line">            shr ah,1                ;右移 4 位，ah 中得到高 4 位的值</span><br><span class="line">            and al,00001111b         ;al 中为低 4 位的值</span><br><span class="line"></span><br><span class="line">            mov bl,ah</span><br><span class="line">            mov bh,0</span><br><span class="line">            mov ah,table[bx]         ;用高 4 位的值作为相对于 table 的偏移，取得对应的字符</span><br><span class="line"></span><br><span class="line">            mov bx,0b800h</span><br><span class="line">             mov es,bx</span><br><span class="line">             mov es:[160*12+40*2],ah </span><br><span class="line"></span><br><span class="line">             mov bl,al</span><br><span class="line">             mov bh,0</span><br><span class="line">             mov al,table[bx]        ;用低 4 位的值作为相对于 table 的偏移，取得对应的字符</span><br><span class="line"></span><br><span class="line">            mov es:[160*12+40*2+2],al</span><br><span class="line"></span><br><span class="line">            pop es</span><br><span class="line">            pop bx</span><br><span class="line"></span><br><span class="line">            ret</span><br></pre></td></tr></table></figure>

<p>子程序中，在数值 0<del>15 中和字符 “0”</del>“F” 之间建立的映射关系位：以数值 N 为 table 表中的偏移，可以找到对应的字符。</p>
<ol start="2">
<li>代码的直接定址表：可以在直接定址表中存储子程序的地址，方便地实现不同子程序的调用。</li>
</ol>
<h4 id="4-中断及其处理"><a href="#4-中断及其处理" class="headerlink" title="4.中断及其处理"></a>4.中断及其处理</h4><p>中断向量表：每个入口地址占用四个字节，保存IP和CS，总共1024个字节</p>
<p>0号中断由除法除以0触发，执行后相当于int 0</p>
<p>中断向量表起始地址为0000：0000</p>
<p>中断程序在其他位置，可由中断向量表寻址跳转</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://raw.githubusercontent.com/showlibia/img/main/image-20230616002739209.png"></p>
<p>类代码描述：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://raw.githubusercontent.com/showlibia/img/main/image-20230616002755008.png"></p>
<h4 id="5-0号中断改编"><a href="#5-0号中断改编" class="headerlink" title="5.0号中断改编"></a>5.0号中断改编</h4><p>中断向量表在内存中存放，对于8086PC机，中断向量表指定放在内存地址0处。<br>从内存0000:0000到0000:03FF的1024个单元中存放着中断向量表。<br>8086 支持 256 个中断，但是，实际上，系统中要处理的中断事件远没有达到256 个 。所以在中断向量表中，有许多单元是空的。<br>中断向量表是PC系统中最重要的内存区，只用来存放中断处理程序的入口地址，DOS 系统和其他应用程序都不会随便使用这段空间。<br>我们可以利用中断向量表中的空闲单元来存放我们的程序。<br>一般情况下：<br>从0000:0200至0000:02FF的256个字节的空间所对应的中断向量表项都是空的，操作系统和其他应用程序都不占用。<br>我们估计，do0的长度不可能超过256个字节。<br>结论：我们可以将do0传送到内存0000:0200处。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line">assume cs:code</span><br><span class="line">COMMENT !</span><br><span class="line">由于中断例程不可能到达256个那么多，所以中断向量表中还有很多是空的</span><br><span class="line">比如0000:0200~0000:02FF这256个字节，所以便把中断例程放置在这个位置</span><br><span class="line">!</span><br><span class="line"></span><br><span class="line">code segment</span><br><span class="line">start:</span><br><span class="line">;安装中断例程</span><br><span class="line">	mov ax, 0</span><br><span class="line">	mov es, ax</span><br><span class="line">	mov di, 200h   ;目的地址es:di 即0000:0200,</span><br><span class="line">	mov ax, cs</span><br><span class="line">	mov ds, ax ;源地址ds:si 即do0的偏移地址，也就是中断处理程序</span><br><span class="line">	mov si, offset do0  </span><br><span class="line">	mov cx, offset do0end - offset do0 ;中断处理程序的字节数,也就是要转移的数量</span><br><span class="line">	cld ;传输方向为正</span><br><span class="line">	rep movsb ;把中断处理程序安装至0000:0200</span><br><span class="line">	mov ax, 0</span><br><span class="line">	mov es, ax</span><br><span class="line">;将中断例程的入口地址放置到中断向量表中</span><br><span class="line">	mov word ptr es:[0 * 4], 200h ;将中断处理程序的入口放在0号中断向量中</span><br><span class="line">	mov word ptr es:[0 * 4 + 2], 0</span><br><span class="line"></span><br><span class="line">	mov ax, 4c00h</span><br><span class="line">	int 21h</span><br><span class="line"></span><br><span class="line">;中断处理程序</span><br><span class="line">do0: ;为了防止字符串被覆盖所以将其放在中断例程里</span><br><span class="line">	jmp short do0start</span><br><span class="line">	db &#x27;Divide overflow!&#x27;, 0</span><br><span class="line">do0start:</span><br><span class="line">	mov ax, 0b800h  ;显存段地址</span><br><span class="line">	mov es, ax</span><br><span class="line">	mov di, 160 * 12 + 36 * 2 ;第13行中间位置</span><br><span class="line">	mov ax, cs</span><br><span class="line">	mov ds, ax</span><br><span class="line">	mov si, 202h ;字符串的偏移地址</span><br><span class="line">	mov cx, 10h ;字符串数目</span><br><span class="line">s:</span><br><span class="line">	mov bl, [si]</span><br><span class="line">	mov es:[di], bl</span><br><span class="line">	mov es:[di + 1], 2</span><br><span class="line">	inc si</span><br><span class="line">	add di, 2</span><br><span class="line">	loop s</span><br><span class="line">	iret  ;返回</span><br><span class="line">do0end:</span><br><span class="line">	nop</span><br><span class="line">code ends</span><br><span class="line">end start</span><br></pre></td></tr></table></figure>

<h4 id="6-单步中断"><a href="#6-单步中断" class="headerlink" title="6.单步中断"></a>6.单步中断</h4><p>基本上，CPU在执行一条指令后，如果检测到标志寄存器的TF位为1，则产生单步中断，引发中断过程. 单步中断的中断类型码为1，则它所引发的中断过程如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">1) 取得中断类型码N；（此时N=1）</span><br><span class="line">2) 标志寄存器入栈，TF、IF设置为0；</span><br><span class="line">3) CS、IP入栈；</span><br><span class="line">4) (IP) = (N*4), (CS) = (N*4+2)</span><br></pre></td></tr></table></figure>

<p><strong>响应中断的特殊情况：</strong></p>
<p>一般情况下，CPU在执行完当前指令后，如果检测到中断信息，就响应中断，引发中断过程. 可是，在有些情况下，CPU在执行完当前指令后，即便是发生中断，也不会响应. 对于这些情况，这里就不一一举例，只是用一种情况进行说明.</p>
<p>在执行完向ss寄存器传送数据的指令后，即便是发生中断，CPU也不会响应. 这样做的主要原因是，ss:sp联合指向栈顶，而对它们的设置应该连续完成. 如果在执行完设置ss的指令后，CPU响应中断，引发中断过程，要在<strong>栈</strong>中压入标志寄存器、CS、IP的值. 而ss改变，sp并未改变，ss:sp指向的不是正确的栈顶，将引起错误. 所以CPU在执行完设置ss的指令后，不响应中断. 这给连续设置ss和sp指向正确的栈顶提供了一个时机. 即，我们应该利用这一特性，将设置ss和sp的指令连续存放，使得sp的指令紧接着设置ss的指令执行，而在此之间，CPU不会引发中断过程. 比如，我们要将栈顶设置1000:0，应该：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mov ax, 1000h</span><br><span class="line">mov ss, ax</span><br><span class="line">mov sp, 0</span><br></pre></td></tr></table></figure>

<p>而不应该：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mov ax,1000h</span><br><span class="line">mov ss, ax</span><br><span class="line">mov ax, 0</span><br><span class="line">mov sp, 0</span><br></pre></td></tr></table></figure>

<h4 id="7-int指令引发的中断"><a href="#7-int指令引发的中断" class="headerlink" title="7.int指令引发的中断"></a>7.int指令引发的中断</h4><p>int 格式：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">int n;n为中断类型码</span><br></pre></td></tr></table></figure>

<p>引发的过程是</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">1) 取得中断类型码N；（此时N=1）</span><br><span class="line">2) 标志寄存器入栈，TF、IF设置为0；</span><br><span class="line">3) CS、IP入栈；</span><br><span class="line">4) (IP) = (N*4), (CS) = (N*4+2)</span><br></pre></td></tr></table></figure>

<p>中断7ch的中断例程:</p>
<p>功能为显示一个用0结束的字符串，中断例程安装在 0:200处。<br>参数：（dh）&#x3D; 行号，（dl）&#x3D; 列号，（cl）&#x3D; 颜色，ds:si指向字符串首地址。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line">assume cs:code, ds:data</span><br><span class="line"></span><br><span class="line">code segment</span><br><span class="line">start:</span><br><span class="line">	jmp install</span><br><span class="line">	mov dh, 10</span><br><span class="line">	mov dl, 10</span><br><span class="line">	mov cl, 2</span><br><span class="line">	mov ax, data</span><br><span class="line">	mov ds, ax</span><br><span class="line">	mov si, 0</span><br><span class="line">	int 7ch</span><br><span class="line">	mov ax, 4c00h</span><br><span class="line">	int 21h</span><br><span class="line">	</span><br><span class="line">install:</span><br><span class="line">	mov ax, 0</span><br><span class="line">	mov es, ax</span><br><span class="line">	mov word ptr es:[4 * 7ch], 200h</span><br><span class="line">	mov word ptr es:[4 * 7ch + 2], 0;安装中断向量表</span><br><span class="line">	</span><br><span class="line">	mov ax, cs</span><br><span class="line">	mov ds, ax</span><br><span class="line">	mov ax, 0</span><br><span class="line">	mov es, ax</span><br><span class="line">	mov si, 0</span><br><span class="line">	mov di, 200h</span><br><span class="line">	mov cx, offset do7chEnd - offset do7ch</span><br><span class="line">	cld</span><br><span class="line">	rep movsb</span><br><span class="line">	</span><br><span class="line">do7ch:</span><br><span class="line">data segment</span><br><span class="line">	db &quot;welcome to masm!&quot;, 0</span><br><span class="line">data ends</span><br><span class="line"></span><br><span class="line">	push cx</span><br><span class="line">	push si</span><br><span class="line">	push di</span><br><span class="line">	</span><br><span class="line">	mov ax, 0b800h</span><br><span class="line">	mov es, ax</span><br><span class="line">	mov ax, data</span><br><span class="line">	mov ds, ax</span><br><span class="line">	mov si, 0;源地址偏移</span><br><span class="line">	mov al, dh</span><br><span class="line">	mov bl, 160</span><br><span class="line">	mul bl	;dh * 160</span><br><span class="line">	add ax, dl</span><br><span class="line">	mov di, ax</span><br><span class="line"></span><br><span class="line">trans:</span><br><span class="line">	mov cl, [si]</span><br><span class="line">	mov ch, 0</span><br><span class="line">	jcxz fin;如果cx = 0，表示已经处理完毕</span><br><span class="line">	mov byte ptr es:[di], cl</span><br><span class="line">	mov byte ptr es:[di + 1], 11000010B</span><br><span class="line">	inc si</span><br><span class="line">	add di, 2</span><br><span class="line">	jmp trans</span><br><span class="line"></span><br><span class="line">fin:</span><br><span class="line">	pop di</span><br><span class="line">	pop si</span><br><span class="line">	pop cx</span><br><span class="line">	iret</span><br><span class="line">	</span><br><span class="line">do7chEnd:</span><br><span class="line">	nop</span><br><span class="line">code ends</span><br><span class="line">end start</span><br></pre></td></tr></table></figure>

<p>CPU 执行 int 7ch 指令进入中断例程之前，标志寄存器、当前的 CS 和 IP 被压入栈中，在执行完中断例程后，应该用 iret 指令恢复 int 7ch 执行前的标志寄存器和 CS、IP 的值，从而接着执行应用程序。</p>
<p>int 指令和 iret 指令的配合使用与 call 指令和 ret 指令的配合使用具有相似的思路。</p>
<h4 id="8-BIOS和DOS中断处理"><a href="#8-BIOS和DOS中断处理" class="headerlink" title="8.BIOS和DOS中断处理"></a>8.BIOS和DOS中断处理</h4><p>BIOS（Basic input&#x2F;output system）固化在 ROM 中，包括 I&#x2F;O 设备的处理程序和许多常用的例行程序。</p>
<p>对用户程序来说，可由特定指令 INT n（n 为中断号）通过软终端的方式调用。不管 DOS 是否装入系统，这些调用可以直接控制 I&#x2F;O 设备。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://raw.githubusercontent.com/showlibia/img/main/image-20230616011603032.png"></p>
<p>MS-DOS（disk operating system）系统功能调用是DOS为程序员编写汇编语言源程序提供了一组常用子程序（80多个），可在汇编语言程序中直接调用。这些子程序的主要功能包括：</p>
<p>(1)设备管理（如键盘、显示器、打印机、磁盘等的管理）</p>
<p>(2)文件管理和目录操作</p>
<p>(3)其他管理（如内存、时间、日期等管理）</p>
<p>这些子程序给用户编程带来很大方便，用户不必了解有关的设备、电路、接口等方面的问题，只需直接调用即可。</p>
<p>MS-DOS 规定用INT 21H进入各功能调用子程序的入口，并为每个功能调用规定了一个功能号，以便进入各个相应子程序的入口。</p>
<p>DOS功能调用的子程序已按顺序编号——功能号（00H～68H），其调用方法是：</p>
<p>(1) 功能号→AH（根据要使用的DOS功能调用设置入口参数）</p>
<p>(2) 入口参数→指定寄存器（将DOS功能调用的编号送入寄存器AH）</p>
<p>(3) 发送软中断指令 INT 21H</p>
<p>调用结束后，系统将出口参数送到指定寄存器、内存或直接送到输出设备</p>
<h4 id="9-端口读写"><a href="#9-端口读写" class="headerlink" title="9.端口读写"></a>9.端口读写</h4><p>CPU 可以直接读写 3 个地方的数据：CPU 内部的寄存器、内存单元、端口。</p>
<p>CPU 通过端口地址来定位端口。因为端口所在的芯片和 CPU 通过总线相连，所以端口地址和内存地址一样，通过地址总线来传送。PC 系统中，CPU 最多可以定位 64KB 个不同的端口。则端口地址的范围为 0~65535。</p>
<p>端口的读写指令只有两条：in 和 out。分别从端口读取和写入数据。</p>
<p>比较 CPU 执行内存访问指令和端口访问指令时，总线上的信息：</p>
<p>当端口号大于255(0ffh)时，必须将端口号存入dx再使用in&#x2F;out</p>
<p>访问内存：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mov ax,ds:[8]</span><br></pre></td></tr></table></figure>

<ul>
<li>CPU 通过地址线将地址信息 8 发出；</li>
<li>CPU 通过控制线发出内存读命令，选中存储器芯片，并通知它，将要从中读取数据；</li>
<li>存储器将 8 号单元中的数据通过数据线送入CPU。</li>
<li>访问端口：</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">in al,60h;将端口号为60h的端口读出字节至al</span><br></pre></td></tr></table></figure>

<ul>
<li>CPU 通过地址线将地址信息 60h 发出；</li>
<li>CPU 通过控制线发出端口读命令，选中端口所在的芯片，并通知它，将要从中读取数据；</li>
<li>端口所在的芯片将 60h 端口中的数据通过数据线送入 CPU。</li>
</ul>
<p>in 和 out 指令中，只能使用 ax 或 al 来存放从端口中读入的数据或要发送到端口中的数据。8 位端口用 al，16 位端口用 ax。</p>
<h5 id="CMOS-RAM-芯片"><a href="#CMOS-RAM-芯片" class="headerlink" title="CMOS RAM 芯片"></a>CMOS RAM 芯片</h5><ol>
<li>该芯片有两个端口，端口地址为 70h 和 71h。CPU 通过这两个端口来读写 CMOS RAM。</li>
<li>70h 为地址端口，存放要访问的 CMOS RAM 单元的地址；71h 为数据端口，存放从选定的 CMOS RAM 单元中读取的数据，或要写入其中的数据。</li>
</ol>
<p>在 CMOS RAM 中，存放着当前的时间：年、月、日、时、分、秒。这 6 个信息的长度都位 1 个字节，存放单元为：</p>
<table>
<thead>
<tr>
<th>时间</th>
<th>秒</th>
<th>分</th>
<th>时</th>
<th>日</th>
<th>月</th>
<th>年</th>
</tr>
</thead>
<tbody><tr>
<td><strong>地址（字节）</strong></td>
<td>00</td>
<td>02</td>
<td>04</td>
<td>07</td>
<td>08</td>
<td>09</td>
</tr>
</tbody></table>
<p>这些数据以 BCD 码的方式存放。</p>
<table>
<thead>
<tr>
<th>十进制数码</th>
<th>0</th>
<th>1</th>
<th>2</th>
<th>3</th>
<th>4</th>
<th>5</th>
<th>6</th>
<th>7</th>
<th>8</th>
<th>9</th>
</tr>
</thead>
<tbody><tr>
<td><strong>BCD 码</strong></td>
<td>00000</td>
<td>0001</td>
<td>0010</td>
<td>0011</td>
<td>0100</td>
<td>0101</td>
<td>0110</td>
<td>0111</td>
<td>1000</td>
<td>1001</td>
</tr>
</tbody></table>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">（1）CMOS RAM中存储着当前的时间：年、月、日、时、分、秒。这6个信息的长度都为1个字节，存放单元为 秒：0，分：2，时：4，日：7，月：8，年：9，这些数据以BCD码存储，BCD码是以4位二进制数表示十进制数的编码方法，例如十进制的0对应的BCD码为0000，十进制9对应的BCD码为1001，因此一个字节可以表示两个BCD码的两位十进制值。</span><br><span class="line">（2）读取CMOS RAM的信息，需要向地址70h写入要访问的单元地址（用al寄存器），然后从数据端口71h中取得指定单元的数据。</span><br><span class="line">（3）BCD码值+30h=10进制数对应的ASCII码。</span><br><span class="line">（4）显示缓存地址为0b800h处，显示器为80字符宽，25行，每个字符用2个字节显示，高位字节为字符，低位字节为显示属性（可采用默认属性）。</span><br><span class="line"></span><br><span class="line">;显示年份</span><br><span class="line">assume cs:code</span><br><span class="line">code segmemt</span><br><span class="line">start:</span><br><span class="line">	;从9号单元读取年份</span><br><span class="line">	mov al,9</span><br><span class="line">	out 70h,al</span><br><span class="line">	in al,71h</span><br><span class="line">	</span><br><span class="line">	mov ah,al</span><br><span class="line">shr ah,4</span><br><span class="line">and al,00001111b</span><br><span class="line">add ah,30h</span><br><span class="line">add al,30h</span><br><span class="line"></span><br><span class="line">mov bx,0b800h</span><br><span class="line">mov es,bx</span><br><span class="line">mov byte ptr es:[160*12+40*2], ah</span><br><span class="line">mov byte ptr es:[160*12+40*2+2], al</span><br><span class="line"></span><br><span class="line">mov ax 4c00h</span><br><span class="line">int 21h</span><br><span class="line"></span><br><span class="line">code ends</span><br><span class="line">end start</span><br></pre></td></tr></table></figure>



<h4 id="10-外中断"><a href="#10-外中断" class="headerlink" title="10.外中断"></a>10.外中断</h4><p><strong>1、可屏蔽中断</strong></p>
<p>可屏蔽中断是CPU可以不响应的外中断。CPU是否响应可屏蔽中断，要看标志寄存器的IF位的设置。当CPU检测到可屏蔽中断信息时，如果IF&#x3D;1，则CPU在执行完当前指令后响应中断，引发中断过程；如果IF&#x3D;0，则不响应可屏蔽中断。</p>
<p>因为可屏蔽中断信息来自于CPU外部，中断类型码是通过数据总线送入CPU的；而内中断的中断类型码是在CPU内部产生的。</p>
<p>现在我们可以解释中断过程中将IF置为0的原因了。将IF置0的原因就是，在进入中断处理程序后，禁止其他的可屏蔽中断。</p>
<p>如果在中断处理程序中需要处理可屏蔽中断，可以用指令将IF置1。8086CPU提供的设置IF的指令如下：</p>
<blockquote>
<p>sti,设置 IF&#x3D;1；<br>cli,设置 IF&#x3D;0。</p>
</blockquote>
<p><strong>2、不可屏蔽中断</strong></p>
<p>不可屏蔽中断是CPU必须响应的外中断。当CPU检测到不可屏蔽中断信息时，则在执行完当前指令后，立即响应引发中断过程。</p>
<p>对于8086CPU，不可屏蔽中断的中断类型码固定为2，所以中断过程中不需要取中断类型码。则不可屏蔽中断的中断过程为：</p>
<p>（1）标志寄存器入栈，IF&#x3D;0，TF&#x3D;0；<br>（2）CS、IP入栈；<br>（3）(IP)&#x3D;(8)，(CS)&#x3D;(0AH)。</p>
<p>几乎所有由外设引发的外中断，都是可屏蔽中断。当外设有需要处理的事件(比如说键盘输入)发生时，相关芯片向CPU发出可屏蔽中断信息。</p>
<h4 id="11-PC机键盘处理"><a href="#11-PC机键盘处理" class="headerlink" title="11.PC机键盘处理"></a>11.PC机键盘处理</h4><p><strong>1. 键盘输入</strong></p>
<p>键盘上的每一个键相当于一个开关，键盘中有一个芯片对键盘上的每一个键的开关状态进行扫描。</p>
<p>按下一个键时，开关接通该芯片就产生一个扫描码，扫描码说明了按下的键在键盘上的位置。</p>
<p>扫描码被送入主板上的相关接口芯片的寄存器中，该寄存器的端口地址为60h。</p>
<p>松开按下的键时，也产生一个扫描码，扫描码说明了松开的键在键盘上的位置。松开按键时产生的扫描码也被送入60h端口中。</p>
<p>一般将按下一个键时产生的扫描码称为通码，松开一个键产生的扫描码称为断码。扫描码长度为一个字节，通码的第7位为0，断码的第7位为1，即：</p>
<p>断码&#x3D;通码+80h</p>
<p><strong>2. 引发9号中断</strong></p>
<p>键盘的输入到达60h端口时，相关的芯片就会向CPU发出中断类型码为9的可屏蔽中断信息。</p>
<p>CPU检测到该中断信息后，如果IF&#x3D;1，则响应中断，引发中断过程转去执行int9中断例程。</p>
<p><strong>3. 执行int9中断例程</strong></p>
<p>BIOS提供了int 9中断例程，用来进行基本的键盘输入处理，主要的工作如下：</p>
<p>（1）读出60h端口中的扫描码；<br>（2）如果是字符键的扫描码，将该扫描码和它所对应的字符码（即ASCII码）送入内存中的BIOS键盘缓冲区；如果是控制键（比如Ctrl）和切换键（比如CapsLock）的扫描码，则将其转变为状态字节（用二进制位记录控制键和切换键状态的字节）写入内存中存储状态字节的单元；<br>（3）对键盘系统进行相关的控制，比如说向相关芯片发出应答信息。</p>
<p>BIOS键盘缓冲区是系统启动后，BIOS用于存放int 9中断例程所接收的键盘输入的内存区。该内存区可以存储15个键盘输入，因为int 9中断例程除了接收扫描码外，还要产生和扫描码对应的字符码，所以在BIOS键盘缓冲区中，一个键盘输入用一个字单元存放，高位字节存放扫描码，低位字节存放字符码。</p>
<h4 id="12-int-9中断例程定制"><a href="#12-int-9中断例程定制" class="headerlink" title="12.int 9中断例程定制"></a>12.int 9中断例程定制</h4><p>仿照前面的</p>
<h4 id="13-中断响应外设"><a href="#13-中断响应外设" class="headerlink" title="13.中断响应外设"></a>13.中断响应外设</h4><p>键盘输入将引发9号中断，BIOS提供了int 9中断例程。CPU在9号中断发生后，执行int 9中断例程，从60h端口读出扫描码，并将其转化为相应的ASCII码或状态信息，存储在内存的指定空间(键盘缓冲区或状态字节)中。</p>
<p>一般的键盘输入，在CPU执行完int 9中断例程后，都放到了键盘缓冲区中</p>
<p>BIOS提供了int 16h中断例程供程序员调用。int 16h中断例程中包含的一个最重要的功能是从键盘缓冲区中读取一个键盘输入，该功能的编号为0。</p>
<p><strong>应用int 13h中断例程对磁盘进行读写</strong></p>
<p>3.5英寸软盘分为上下两面，每面有80个磁道，每个磁道又分为18个扇区，每个扇区的大小为512个字节。</p>
<p>则：2面x80磁道x18扇区x512字节&#x3D;1440KB≈1.44MB</p>
<p>磁盘的实际访问由磁盘控制器进行，我们可以通过控制磁盘控制器来访问磁盘。只能以扇区为单位对磁盘进行读写。在读写扇区的时候，要给出面号、磁道号和扇区号。面号和磁道号从0开始，而扇区号从1开始。</p>
<p>BIOS提供的访问磁盘的中断例程为int 13h。读取0面0道1扇区的内容到0:200的程序如下所示。</p>
<blockquote>
<p>mov ax,0<br>mov es,ax<br>mov bx,200h</p>
<p>mov al,1<br>mov ch,0<br>mov cl,1<br>mov dl,0<br>mov dh,0<br>mov ah,2<br>int 13h</p>
</blockquote>
<p>入口参数:</p>
<blockquote>
<p>(ah)&#x3D;int 13h的功能号(2表示读扇区)<br>(al)&#x3D;读取的扇区数<br>(ch)&#x3D;磁道号<br>(cl)&#x3D;扇区号<br>(dh)&#x3D;磁头号(对于软盘即面号，因为一个面用一个磁头来读写)<br>(dl)&#x3D;驱动器号<br>软驱从0开始，0：软驱A, 1：软驱B；<br>硬盘从80h开始，80h：硬盘C, 81h：硬盘D<br>es:bx指向接收从扇区读入数据的内存区</p>
</blockquote>
<p>返回参数：</p>
<p>操作成功：(ah)&#x3D;0，(al)&#x3D;读入的扇区数<br>操作失败：(ah)&#x3D;出错代码</p>
<p>将0:200中的内容写入0面0道1扇区。</p>
<blockquote>
<p>mov ax,0<br>mov es,ax<br>mov bx,200h</p>
<p>mov al,1<br>mov ch, 0<br>mov cl,1<br>mov dl,0<br>mov dh,0</p>
<p>mov ah,3<br>int 13h</p>
</blockquote>
<p>入口参数：</p>
<blockquote>
<p>(ah)&#x3D;int 13h的功能号(3表示写扇区)<br>(al)&#x3D;写入的扇区数<br>(ch)&#x3D;磁道号<br>(cl)&#x3D;扇区号<br>(dh)&#x3D;磁头号(面)<br>(dl)&#x3D;驱动器号<br>软驱从0开始，0：软驱A, 1：软驱B；<br>硬盘从80h开始，80h：硬盘C, 81h：硬盘D<br>es:bx指向将写入磁盘的数据</p>
</blockquote>
<p>返回参数：</p>
<p>操作成功：(ah)&#x3D;0，(al)&#x3D;写入的扇区数<br>操作失败：(ah)&#x3D;出错代码</p>
</article><div class="post-copyright"><div class="copyright-cc-box"><i class="anzhiyufont anzhiyu-icon-copyright"></i></div><div class="post-copyright__author_box"><a class="post-copyright__author_img" href="/" title="头像"><img class="post-copyright__author_img_back" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/null" title="头像" alt="头像"><img class="post-copyright__author_img_front" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/null" title="头像" alt="头像"></a><div class="post-copyright__author_name">Matrix</div><div class="post-copyright__author_desc"></div></div><div class="post-copyright__post__info"><a class="post-copyright__original" title="该文章为原创文章，注意版权协议" href="http://blog.zymatrix.top/2023/06/18/%E6%B1%87%E7%BC%96%E8%AF%AD%E8%A8%80/">原创</a><a class="post-copyright-title"><span onclick="rm.copyPageUrl('http://blog.zymatrix.top/2023/06/18/%E6%B1%87%E7%BC%96%E8%AF%AD%E8%A8%80/')">汇编语言</span></a></div><div class="post-tools" id="post-tools"><div class="post-tools-left"><div class="rewardLeftButton"></div><div class="shareRight"><div class="share-link mobile"><div class="share-qrcode"><div class="share-button" title="使用手机访问这篇文章"><i class="anzhiyufont anzhiyu-icon-qrcode"></i></div><div class="share-main"><div class="share-main-all"><div id="qrcode" title="http://blog.zymatrix.top/2023/06/18/%E6%B1%87%E7%BC%96%E8%AF%AD%E8%A8%80/"></div><div class="reward-dec">使用手机访问这篇文章</div></div></div></div></div><div class="share-link weibo"><a class="share-button" target="_blank" href="https://service.weibo.com/share/share.php?title=汇编语言&amp;url=http://blog.zymatrix.top/2023/06/18/%E6%B1%87%E7%BC%96%E8%AF%AD%E8%A8%80/&amp;pic=" rel="external nofollow noreferrer noopener"><i class="anzhiyufont anzhiyu-icon-weibo"></i></a></div><script>function copyCurrentPageUrl() {
  var currentPageUrl = window.location.href;
  var input = document.createElement("input");
  input.setAttribute("value", currentPageUrl);
  document.body.appendChild(input);
  input.select();
  input.setSelectionRange(0, 99999);
  document.execCommand("copy");
  document.body.removeChild(input);
}</script><div class="share-link copyurl"><div class="share-button" id="post-share-url" title="复制链接" onclick="copyCurrentPageUrl()"><i class="anzhiyufont anzhiyu-icon-link"></i></div></div></div></div></div><div class="post-copyright__notice"><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://blog.zymatrix.top" target="_blank">Matrix's blog</a>！</span></div></div><div class="post-tools-right"><div class="tag_share"><div class="post-meta__box"><div class="post-meta__box__tag-list"><a class="post-meta__box__tags" href="/tags/%E6%B1%87%E7%BC%96%E8%AF%AD%E8%A8%80/"><span class="tags-punctuation"> <i class="anzhiyufont anzhiyu-icon-tag"></i></span>汇编语言<span class="tagsPageCount">1</span></a></div></div></div><div class="post_share"><div class="social-share" data-image="/null" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.cbd.int/butterfly-extsrc@1.1.3/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"/><script src="https://cdn.cbd.int/butterfly-extsrc@1.1.3/sharejs/dist/js/social-share.min.js" defer="defer"></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2023/05/11/%E3%80%8A%E5%B8%9D%E5%9B%BD%E4%B8%BB%E4%B9%89%E6%98%AF%E8%B5%84%E6%9C%AC%E4%B8%BB%E4%B9%89%E7%9A%84%E6%9C%80%E9%AB%98%E9%98%B6%E6%AE%B5%E3%80%8B/"><img class="prev-cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">《帝国主义是资本主义的最高阶段》</div></div></a></div><div class="next-post pull-right"><a href="/2023/08/11/web/"><img class="next-cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">WEB Security</div></div></a></div></nav></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="card-content"><div class="author-info-avatar"><img class="avatar-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/null" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__description">那时她还年轻，不知道命运馈赠的礼物都在暗中标好了价格</div></div></div><div class="card-widget anzhiyu-right-widget" id="card-wechat" onclick="null"><div id="flip-wrapper"><div id="flip-content"><div class="face" style="background: url(https://bu.dusays.com/2023/01/13/63c02edf44033.png) center center / 100% no-repeat"></div><div class="back face" style="background: url(https://bu.dusays.com/2023/05/13/645fa415e8694.png) center center / 100% no-repeat"></div></div></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-bars"></i><span>文章目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%80%E3%80%81mul-div-and-or-shl-shr-inc-dec%E6%8C%87%E4%BB%A4%EF%BC%8C%E4%B8%AD%E6%96%ADint"><span class="toc-number">1.</span> <span class="toc-text">一、mul,div,and,or ,shl,shr,inc,dec指令，中断int</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%80%BB%E7%BA%BF"><span class="toc-number">1.1.</span> <span class="toc-text">总线</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%8C%E3%80%81%E5%AF%84%E5%AD%98%E5%99%A8"><span class="toc-number">2.</span> <span class="toc-text">二、寄存器</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-ds%E5%AF%84%E5%AD%98%E5%99%A8%EF%BC%8C%E6%AE%B5%E5%9C%B0%E5%9D%80%E3%80%81%E5%81%8F%E7%A7%BB%E5%9C%B0%E5%9D%80%E3%80%81%E7%89%A9%E7%90%86%E5%9C%B0%E5%9D%80"><span class="toc-number">2.1.</span> <span class="toc-text">1.ds寄存器，段地址、偏移地址、物理地址</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-CS-IP%E4%BB%A3%E7%A0%81%E6%AE%B5%E5%AF%84%E5%AD%98%E5%99%A8%EF%BC%8Cjmp-jcxz%E6%8C%87%E4%BB%A4"><span class="toc-number">2.2.</span> <span class="toc-text">2.CS-IP代码段寄存器，jmp,jcxz指令</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-SS-SP%E5%AF%84%E5%AD%98%E5%99%A8%EF%BC%8C%E6%A0%88%E7%9A%84push-pop%E6%8C%87%E4%BB%A4"><span class="toc-number">2.3.</span> <span class="toc-text">3.SS-SP寄存器，栈的push,pop指令</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-bp-si-di%E5%AF%84%E5%AD%98%E5%99%A8%EF%BC%8C%E5%AF%BB%E5%9D%80%E6%96%B9%E5%BC%8F%E4%BB%A5%E5%8F%8A%E5%85%B6%E4%BB%96%E7%9A%84%E5%AF%84%E5%AD%98%E5%99%A8"><span class="toc-number">2.4.</span> <span class="toc-text">4.bp,si,di寄存器，寻址方式以及其他的寄存器</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-%E6%A0%87%E5%BF%97%E4%BD%8D%E5%AF%84%E5%AD%98%E5%99%A8ZF-PF-SF-CF-OF-DF%E5%92%8C%E4%B8%B2%E4%BC%A0%E9%80%81%E6%8C%87%E4%BB%A4pushf%E5%92%8Cpopf"><span class="toc-number">2.5.</span> <span class="toc-text">5.标志位寄存器ZF,PF,SF,CF,OF,DF和串传送指令pushf和popf</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-%E6%9D%A1%E4%BB%B6%E5%88%A4%E6%96%AD%E8%AF%AD%E5%8F%A5cmp-je-ja-jb-adc-sbb"><span class="toc-number">2.6.</span> <span class="toc-text">6.条件判断语句cmp,je,ja,jb,adc,sbb</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%89%E3%80%81%E7%BC%96%E5%86%99%E7%A8%8B%E5%BA%8F"><span class="toc-number">3.</span> <span class="toc-text">三、编写程序</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-%E5%BE%AA%E7%8E%AF%E8%AF%AD%E5%8F%A5loop%EF%BC%8Ccall%E5%92%8Cret%E6%8C%87%E4%BB%A4%E5%86%99%E5%87%BD%E6%95%B0%EF%BC%8Ccall-far-ptr%E5%92%8Cretf%E6%8C%87%E4%BB%A4%EF%BC%8C%E6%9C%AC%E8%B4%A8%E6%98%AF%E6%A0%88"><span class="toc-number">3.1.</span> <span class="toc-text">1.循环语句loop，call和ret指令写函数，call far ptr和retf指令，本质是栈</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-%E4%BB%A3%E7%A0%81%E6%AE%B5%E3%80%81%E6%95%B0%E6%8D%AE%E6%AE%B5%E3%80%81%E6%A0%88%E6%AE%B5%E3%80%81dup%E6%8C%87%E4%BB%A4"><span class="toc-number">3.2.</span> <span class="toc-text">2.代码段、数据段、栈段、dup指令</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-offset%E6%8C%87%E4%BB%A4-jmp-short%E3%80%81far-dword-ptr%E7%AD%89%E8%B7%B3%E8%BD%AC%E6%8C%87%E4%BB%A4"><span class="toc-number">3.3.</span> <span class="toc-text">3.offset指令,jmp short、far,dword ptr等跳转指令</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9B%9B%E3%80%81%E4%B8%AD%E6%96%AD"><span class="toc-number">4.</span> <span class="toc-text">四、中断</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-%E6%93%8D%E4%BD%9C%E6%98%BE%E5%AD%98%E6%95%B0%E6%8D%AE"><span class="toc-number">4.1.</span> <span class="toc-text">1.操作显存数据</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-%E6%A0%87%E5%8F%B7"><span class="toc-number">4.2.</span> <span class="toc-text">2.标号</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-%E7%9B%B4%E6%8E%A5%E5%AE%9A%E5%9D%80%E8%A1%A8"><span class="toc-number">4.3.</span> <span class="toc-text">3.直接定址表</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-%E4%B8%AD%E6%96%AD%E5%8F%8A%E5%85%B6%E5%A4%84%E7%90%86"><span class="toc-number">4.4.</span> <span class="toc-text">4.中断及其处理</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-0%E5%8F%B7%E4%B8%AD%E6%96%AD%E6%94%B9%E7%BC%96"><span class="toc-number">4.5.</span> <span class="toc-text">5.0号中断改编</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-%E5%8D%95%E6%AD%A5%E4%B8%AD%E6%96%AD"><span class="toc-number">4.6.</span> <span class="toc-text">6.单步中断</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#7-int%E6%8C%87%E4%BB%A4%E5%BC%95%E5%8F%91%E7%9A%84%E4%B8%AD%E6%96%AD"><span class="toc-number">4.7.</span> <span class="toc-text">7.int指令引发的中断</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#8-BIOS%E5%92%8CDOS%E4%B8%AD%E6%96%AD%E5%A4%84%E7%90%86"><span class="toc-number">4.8.</span> <span class="toc-text">8.BIOS和DOS中断处理</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#9-%E7%AB%AF%E5%8F%A3%E8%AF%BB%E5%86%99"><span class="toc-number">4.9.</span> <span class="toc-text">9.端口读写</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#CMOS-RAM-%E8%8A%AF%E7%89%87"><span class="toc-number">4.9.1.</span> <span class="toc-text">CMOS RAM 芯片</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#10-%E5%A4%96%E4%B8%AD%E6%96%AD"><span class="toc-number">4.10.</span> <span class="toc-text">10.外中断</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#11-PC%E6%9C%BA%E9%94%AE%E7%9B%98%E5%A4%84%E7%90%86"><span class="toc-number">4.11.</span> <span class="toc-text">11.PC机键盘处理</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#12-int-9%E4%B8%AD%E6%96%AD%E4%BE%8B%E7%A8%8B%E5%AE%9A%E5%88%B6"><span class="toc-number">4.12.</span> <span class="toc-text">12.int 9中断例程定制</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#13-%E4%B8%AD%E6%96%AD%E5%93%8D%E5%BA%94%E5%A4%96%E8%AE%BE"><span class="toc-number">4.13.</span> <span class="toc-text">13.中断响应外设</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-history"></i><span>最近发布</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2024/09/07/Java%E5%90%8E%E7%AB%AF%E5%BC%80%E5%8F%91/" title="Java后端学习笔记">Java后端学习笔记</a><time datetime="2024-09-06T16:00:00.000Z" title="发表于 2024-09-07 00:00:00">2024-09-07</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2024/09/07/MyBatis%E7%AC%94%E8%AE%B0/" title="MyBatis学习笔记">MyBatis学习笔记</a><time datetime="2024-09-06T16:00:00.000Z" title="发表于 2024-09-07 00:00:00">2024-09-07</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2024/09/07/MySQL%E7%AC%94%E8%AE%B0/" title="MySQL学习笔记">MySQL学习笔记</a><time datetime="2024-09-06T16:00:00.000Z" title="发表于 2024-09-07 00:00:00">2024-09-07</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2024/08/12/JavaSE/" title="JavaSE">JavaSE</a><time datetime="2024-08-11T16:00:00.000Z" title="发表于 2024-08-12 00:00:00">2024-08-12</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2024/04/25/DRF%E5%BC%80%E5%8F%91%E7%AC%94%E8%AE%B0/" title="DRF开发">DRF开发</a><time datetime="2024-04-24T16:00:00.000Z" title="发表于 2024-04-25 00:00:00">2024-04-25</time></div></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div id="workboard"><img class="workSituationImg boardsign" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://npm.elemecdn.com/anzhiyu-blog@2.0.4/img/badge/安知鱼-上班摸鱼中.svg" alt="距离月入25k也就还差一个大佬带我~" title="距离月入25k也就还差一个大佬带我~"/><div id="runtimeTextTip"></div></div></div><div id="footer-bar"><div class="footer-bar-links"><div class="footer-bar-left"><div id="footer-bar-tips"><div class="copyright">&copy;2023 - 2024 By <a class="footer-bar-link" href="/" title="Matrix" target="_blank">Matrix</a></div></div><div id="footer-type-tips"></div></div><div class="footer-bar-right"><a class="footer-bar-link" target="_blank" rel="noopener" href="https://github.com/anzhiyu-c/hexo-theme-anzhiyu" title="主题">主题</a></div></div></div></footer></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="sidebar-site-data site-data is-center"><a href="/archives/" title="archive"><div class="headline">文章</div><div class="length-num">18</div></a><a href="/tags/" title="tag"><div class="headline">标签</div><div class="length-num">13</div></a><a href="/categories/" title="category"><div class="headline">分类</div><div class="length-num">3</div></a></div><span class="sidebar-menu-item-title">功能</span><div class="sidebar-menu-item"><a class="darkmode_switchbutton menu-child" href="javascript:void(0);" title="显示模式"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i><span>显示模式</span></a></div><div class="back-menu-list-groups"><div class="back-menu-list-group"><div class="back-menu-list-title">网页</div><div class="back-menu-list"><a class="back-menu-item" href="https://blog.zymatrix.top/" title="博客"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/favicon.ico" alt="博客"/><span class="back-menu-item-text">博客</span></a></div></div><div class="back-menu-list-group"><div class="back-menu-list-title">项目</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https://image.anheyu.com/" title="安知鱼图床"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://image.anheyu.com/favicon.ico" alt="安知鱼图床"/><span class="back-menu-item-text">安知鱼图床</span></a></div></div></div><span class="sidebar-menu-item-title">标签</span><div class="card-tags"><div class="item-headline"></div><div class="card-tag-cloud"><a href="/tags/CTF/" style="font-size: 0.88rem;">CTF<sup>1</sup></a><a href="/tags/Java/" style="font-size: 0.88rem;">Java<sup>2</sup></a><a href="/tags/JavaSE/" style="font-size: 0.88rem;">JavaSE<sup>1</sup></a><a href="/tags/Linux-Kernel/" style="font-size: 0.88rem;">Linux Kernel<sup>1</sup></a><a href="/tags/OS/" style="font-size: 0.88rem;">OS<sup>2</sup></a><a href="/tags/Python/" style="font-size: 0.88rem;">Python<sup>1</sup></a><a href="/tags/Web%E5%90%8E%E7%AB%AF/" style="font-size: 0.88rem;">Web后端<sup>1</sup></a><a href="/tags/csapp/" style="font-size: 0.88rem;">csapp<sup>1</sup></a><a href="/tags/%E5%93%B2%E5%AD%A6/" style="font-size: 0.88rem;">哲学<sup>5</sup></a><a href="/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/" style="font-size: 0.88rem;">数据库<sup>1</sup></a><a href="/tags/%E6%9D%82%E8%AE%B0/" style="font-size: 0.88rem;">杂记<sup>3</sup></a><a href="/tags/%E6%B1%87%E7%BC%96%E8%AF%AD%E8%A8%80/" style="font-size: 0.88rem;">汇编语言<sup>1</sup></a><a href="/tags/%E9%A9%AC%E5%88%97%E6%AF%9B/" style="font-size: 0.88rem;">马列毛<sup>5</sup></a></div></div><hr/></div></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="anzhiyufont anzhiyu-icon-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">繁</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="anzhiyufont anzhiyu-icon-arrows-left-right"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="anzhiyufont anzhiyu-icon-gear"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="anzhiyufont anzhiyu-icon-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></button></div></div><div id="nav-music"><a id="nav-music-hoverTips" onclick="anzhiyu.musicToggle()" accesskey="m">播放音乐</a><div id="console-music-bg"></div><meting-js id="8152976493" server="netease" type="playlist" mutex="true" preload="none" theme="var(--anzhiyu-main)" data-lrctype="0" order="random" volume="0.7"></meting-js></div><div id="rightMenu"><div class="rightMenu-group rightMenu-small"><div class="rightMenu-item" id="menu-backward"><i class="anzhiyufont anzhiyu-icon-arrow-left"></i></div><div class="rightMenu-item" id="menu-forward"><i class="anzhiyufont anzhiyu-icon-arrow-right"></i></div><div class="rightMenu-item" id="menu-refresh"><i class="anzhiyufont anzhiyu-icon-arrow-rotate-right" style="font-size: 1rem;"></i></div><div class="rightMenu-item" id="menu-top"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></div></div><div class="rightMenu-group rightMenu-line rightMenuPlugin"><div class="rightMenu-item" id="menu-copytext"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制选中文本</span></div><div class="rightMenu-item" id="menu-pastetext"><i class="anzhiyufont anzhiyu-icon-paste"></i><span>粘贴文本</span></div><a class="rightMenu-item" id="menu-commenttext"><i class="anzhiyufont anzhiyu-icon-comment-medical"></i><span>引用到评论</span></a><div class="rightMenu-item" id="menu-newwindow"><i class="anzhiyufont anzhiyu-icon-window-restore"></i><span>新窗口打开</span></div><div class="rightMenu-item" id="menu-copylink"><i class="anzhiyufont anzhiyu-icon-link"></i><span>复制链接地址</span></div><div class="rightMenu-item" id="menu-copyimg"><i class="anzhiyufont anzhiyu-icon-images"></i><span>复制此图片</span></div><div class="rightMenu-item" id="menu-downloadimg"><i class="anzhiyufont anzhiyu-icon-download"></i><span>下载此图片</span></div><div class="rightMenu-item" id="menu-newwindowimg"><i class="anzhiyufont anzhiyu-icon-window-restore"></i><span>新窗口打开图片</span></div><div class="rightMenu-item" id="menu-search"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span>站内搜索</span></div><div class="rightMenu-item" id="menu-searchBaidu"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span>百度搜索</span></div><div class="rightMenu-item" id="menu-music-toggle"><i class="anzhiyufont anzhiyu-icon-play"></i><span>播放音乐</span></div><div class="rightMenu-item" id="menu-music-back"><i class="anzhiyufont anzhiyu-icon-backward"></i><span>切换到上一首</span></div><div class="rightMenu-item" id="menu-music-forward"><i class="anzhiyufont anzhiyu-icon-forward"></i><span>切换到下一首</span></div><div class="rightMenu-item" id="menu-music-playlist" onclick="window.open(&quot;https://y.qq.com/n/ryqq/playlist/8802438608&quot;, &quot;_blank&quot;);" style="display: none;"><i class="anzhiyufont anzhiyu-icon-radio"></i><span>查看所有歌曲</span></div><div class="rightMenu-item" id="menu-music-copyMusicName"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制歌名</span></div></div><div class="rightMenu-group rightMenu-line rightMenuOther"><a class="rightMenu-item menu-link" id="menu-randomPost"><i class="anzhiyufont anzhiyu-icon-shuffle"></i><span>随便逛逛</span></a><a class="rightMenu-item menu-link" href="/categories/"><i class="anzhiyufont anzhiyu-icon-cube"></i><span>博客分类</span></a><a class="rightMenu-item menu-link" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags"></i><span>文章标签</span></a></div><div class="rightMenu-group rightMenu-line rightMenuOther"><a class="rightMenu-item" id="menu-copy" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制地址</span></a><a class="rightMenu-item" id="menu-commentBarrage" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-message"></i><span class="menu-commentBarrage-text">关闭热评</span></a><a class="rightMenu-item" id="menu-darkmode" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i><span class="menu-darkmode-text">深色模式</span></a><a class="rightMenu-item" id="menu-translate" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-language"></i><span>轉為繁體</span></a></div></div><div id="rightmenu-mask"></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.cbd.int/@fancyapps/ui@5.0.28/dist/fancybox/fancybox.umd.js"></script><script src="https://cdn.cbd.int/instant.page@5.2.0/instantpage.js" type="module"></script><script src="https://cdn.cbd.int/vanilla-lazyload@17.8.5/dist/lazyload.iife.min.js"></script><script src="https://cdn.cbd.int/node-snackbar@0.1.16/dist/snackbar.min.js"></script><canvas id="universe"></canvas><script async src="https://npm.elemecdn.com/anzhiyu-theme-static@1.0.0/dark/dark.js"></script><script>// 消除控制台打印
var HoldLog = console.log;
console.log = function () {};
let now1 = new Date();
queueMicrotask(() => {
  const Log = function () {
    HoldLog.apply(console, arguments);
  }; //在恢复前输出日志
  const grt = new Date("04/06/2023 00:00:00"); //此处修改你的建站时间或者网站上线时间
  now1.setTime(now1.getTime() + 250);
  const days = (now1 - grt) / 1000 / 60 / 60 / 24;
  const dnum = Math.floor(days);
  const ascll = [
    `欢迎使用安知鱼!`,
    `生活明朗, 万物可爱`,
    `
        
       █████╗ ███╗   ██╗███████╗██╗  ██╗██╗██╗   ██╗██╗   ██╗
      ██╔══██╗████╗  ██║╚══███╔╝██║  ██║██║╚██╗ ██╔╝██║   ██║
      ███████║██╔██╗ ██║  ███╔╝ ███████║██║ ╚████╔╝ ██║   ██║
      ██╔══██║██║╚██╗██║ ███╔╝  ██╔══██║██║  ╚██╔╝  ██║   ██║
      ██║  ██║██║ ╚████║███████╗██║  ██║██║   ██║   ╚██████╔╝
      ╚═╝  ╚═╝╚═╝  ╚═══╝╚══════╝╚═╝  ╚═╝╚═╝   ╚═╝    ╚═════╝
        
        `,
    "已上线",
    dnum,
    "天",
    "©2023 By 安知鱼 V1.6.12",
  ];
  const ascll2 = [`NCC2-036`, `调用前置摄像头拍照成功，识别为【小笨蛋】.`, `Photo captured: `, `🤪`];

  setTimeout(
    Log.bind(
      console,
      `\n%c${ascll[0]} %c ${ascll[1]} %c ${ascll[2]} %c${ascll[3]}%c ${ascll[4]}%c ${ascll[5]}\n\n%c ${ascll[6]}\n`,
      "color:#425AEF",
      "",
      "color:#425AEF",
      "color:#425AEF",
      "",
      "color:#425AEF",
      ""
    )
  );
  setTimeout(
    Log.bind(
      console,
      `%c ${ascll2[0]} %c ${ascll2[1]} %c \n${ascll2[2]} %c\n${ascll2[3]}\n`,
      "color:white; background-color:#4fd953",
      "",
      "",
      'background:url("https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/tinggge.gif") no-repeat;font-size:450%'
    )
  );

  setTimeout(Log.bind(console, "%c WELCOME %c 你好，小笨蛋.", "color:white; background-color:#4f90d9", ""));

  setTimeout(
    console.warn.bind(
      console,
      "%c ⚡ Powered by 安知鱼 %c 你正在访问 Matrix 的博客.",
      "color:white; background-color:#f0ad4e",
      ""
    )
  );

  setTimeout(Log.bind(console, "%c W23-12 %c 你已打开控制台.", "color:white; background-color:#4f90d9", ""));

  setTimeout(
    console.warn.bind(console, "%c S013-782 %c 你现在正处于监控中.", "color:white; background-color:#d9534f", "")
  );
});</script><script async src="/anzhiyu/random.js"></script><script async="async">(function () {
  var grt = new Date("04/06/2023 00:00:00"); //设置网站上线时间
  var now = new Date();
  var dnum;
  var hnum;
  var mnum;
  var snum;
  var nowHour;

  // 计算并更新天数、小时数、分钟数和秒数
  function updateTime() {
    now = new Date(); // 更新 now 的值
    nowHour = now.getHours(); // 更新 nowHour 的值
    var days = (now - grt) / 1000 / 60 / 60 / 24;
    dnum = Math.floor(days);
    var hours = (now - grt) / 1000 / 60 / 60 - 24 * dnum;
    hnum = Math.floor(hours);
    if (String(hnum).length == 1) {
      hnum = "0" + hnum;
    }
    var minutes = (now - grt) / 1000 / 60 - 24 * 60 * dnum - 60 * hnum;
    mnum = Math.floor(minutes);
    if (String(mnum).length == 1) {
      mnum = "0" + mnum;
    }
    var seconds = (now - grt) / 1000 - 24 * 60 * 60 * dnum - 60 * 60 * hnum - 60 * mnum;
    snum = Math.round(seconds);
    if (String(snum).length == 1) {
      snum = "0" + snum;
    }
  }

  // 更新网页中显示的网站运行时间
  function updateHtml() {
    const footer = document.getElementById("footer");
    if (!footer) return
    let currentTimeHtml = "";
    if (nowHour < 18 && nowHour >= 9) {
      // 如果是上班时间，默认就是"安知鱼-上班摸鱼中.svg"图片，不需要更改
      currentTimeHtml = `本站居然运行了 ${dnum} 天<span id='runtime'> ${hnum} 小时 ${mnum} 分 ${snum} 秒 </span><i class='anzhiyufont anzhiyu-icon-heartbeat' style='color:red'></i>`;
    } else {
      // 如果是下班时间，插入"安知鱼-下班啦.svg"图片
      let img = document.querySelector("#workboard .workSituationImg");
      if (img != null) {
        img.src = "https://npm.elemecdn.com/anzhiyu-blog@2.0.4/img/badge/安知鱼-下班啦.svg";
        img.title = "下班了就该开开心心的玩耍，嘿嘿~";
        img.alt = "下班了就该开开心心的玩耍，嘿嘿~";
      }

      currentTimeHtml = `本站居然运行了 ${dnum} 天<span id='runtime'> ${hnum} 小时 ${mnum} 分 ${snum} 秒 </span><i class='anzhiyufont anzhiyu-icon-heartbeat' style='color:red'></i>`;
    }

    if (document.getElementById("runtimeTextTip")) {
      document.getElementById("runtimeTextTip").innerHTML = currentTimeHtml;
    }
  }

  setInterval(() => {
    updateTime();
    updateHtml();
  }, 1000);
})();</script><div class="js-pjax"><input type="hidden" name="page-type" id="page-type" value="post"></div><script>var visitorMail = "";
</script><script async data-pjax src="https://cdn.cbd.int/anzhiyu-theme-static@1.0.0/waterfall/waterfall.js"></script><script src="https://lf3-cdn-tos.bytecdntp.com/cdn/expire-1-M/qrcodejs/1.0.0/qrcode.min.js"></script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.1.9/icon/ali_iconfont_css.css"><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.0.0/aplayer/APlayer.min.css" media="print" onload="this.media='all'"><script src="https://cdn.cbd.int/anzhiyu-blog-static@1.0.1/js/APlayer.min.js"></script><script src="https://cdn.cbd.int/hexo-anzhiyu-music@1.0.1/assets/js/Meting2.min.js"></script><script src="https://cdn.cbd.int/pjax@0.2.8/pjax.min.js"></script><script>let pjaxSelectors = ["head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"]
var pjax = new Pjax({
  elements: 'a:not([target="_blank"])',
  selectors: pjaxSelectors,
  cacheBust: false,
  analytics: false,
  scrollRestoration: false
})

document.addEventListener('pjax:send', function () {
  // removeEventListener scroll 
  anzhiyu.removeGlobalFnEvent('pjax')
  anzhiyu.removeGlobalFnEvent('themeChange')

  document.getElementById('rightside').classList.remove('rightside-show')
  
  if (window.aplayers) {
    for (let i = 0; i < window.aplayers.length; i++) {
      if (!window.aplayers[i].options.fixed) {
        window.aplayers[i].destroy()
      }
    }
  }

  typeof typed === 'object' && typed.destroy()

  //reset readmode
  const $bodyClassList = document.body.classList
  $bodyClassList.contains('read-mode') && $bodyClassList.remove('read-mode')
})

document.addEventListener('pjax:complete', function () {
  window.refreshFn()

  document.querySelectorAll('script[data-pjax]').forEach(item => {
    const newScript = document.createElement('script')
    const content = item.text || item.textContent || item.innerHTML || ""
    Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
    newScript.appendChild(document.createTextNode(content))
    item.parentNode.replaceChild(newScript, item)
  })

  GLOBAL_CONFIG.islazyload && window.lazyLoadInstance.update()

  typeof panguInit === 'function' && panguInit()

  // google analytics
  typeof gtag === 'function' && gtag('config', '', {'page_path': window.location.pathname});

  // baidu analytics
  typeof _hmt === 'object' && _hmt.push(['_trackPageview',window.location.pathname]);

  typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()

  // prismjs
  typeof Prism === 'object' && Prism.highlightAll()
})

document.addEventListener('pjax:error', e => {
  if (e.request.status === 404) {
    pjax.loadUrl('/404.html')
  }
})</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script charset="UTF-8" src="https://cdn.cbd.int/anzhiyu-theme-static@1.1.5/accesskey/accesskey.js"></script></div><div id="popup-window"><div class="popup-window-title">通知</div><div class="popup-window-divider"></div><div class="popup-window-content"><div class="popup-tip">你好呀</div><div class="popup-link"><i class="anzhiyufont anzhiyu-icon-arrow-circle-right"></i></div></div></div></body></html>